<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>apply/call/bind ä¸€ç½‘æ‰“å°½</title>
    <url>/2020/04/28/apply-call-bind/</url>
    <content><![CDATA[<p>é¦–å…ˆï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ”¹å˜ this æŒ‡å‘çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒä»¬çš„å¼‚åŒã€‚</p>
<a id="more"></a>

<h1 id="1-apply"><a href="#1-apply" class="headerlink" title="1. apply"></a>1. apply</h1><ul>
<li>è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨å¦ä¸€ä¸ªå¯¹è±¡æ›¿æ¢å½“å‰å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š<code>B.apply(A, arguments)</code>; å³ A å¯¹è±¡åº”ç”¨ B å¯¹è±¡çš„æ–¹æ³•ã€‚</li>
<li>è¦æ³¨æ„çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°å¤„äºéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåˆ™æŒ‡å®šä¸º null æˆ– undefined æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºæŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œè€Œå…¶ä»–åŸå§‹å€¼åˆ™ä¼šè¢«ç›¸åº”çš„åŒ…è£…å¯¹è±¡ï¼ˆwrapper objectï¼‰æ‰€æ›¿ä»£ã€‚</li>
</ul>
<h2 id="1-1-å¦‚ä½•å®ç°ä¸€ä¸ªapply"><a href="#1-1-å¦‚ä½•å®ç°ä¸€ä¸ªapply" class="headerlink" title="1.1 å¦‚ä½•å®ç°ä¸€ä¸ªapply"></a>1.1 å¦‚ä½•å®ç°ä¸€ä¸ªapply</h2><p>å›é¡¾ä¸€ä¸‹ apply çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´æŒ‰ä»¥ä¸‹æ€è·¯èµ°</p>
<ol>
<li>å®ç°ç¬¬ä¸€ä¸ªå‚æ•°çš„åŠŸèƒ½ï¼Œæ”¹å˜ this æŒ‡å‘</li>
<li>å®ç°ç¬¬äºŒä¸ªå‚æ•°çš„åŠŸèƒ½ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½œä¸ºè°ƒç”¨å‡½æ•°çš„å‚æ•°</li>
<li>è¿”å›å€¼ï¼šä½¿ç”¨è°ƒç”¨è€…æä¾›çš„ this å€¼å’Œå‚æ•°è°ƒç”¨è¯¥å‡½æ•°çš„è¿”å›å€¼ã€‚è‹¥è¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™è¿”å› undefinedã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰ä»¥ä¸Šæ€è·¯æ¥å®ç°ä¸€ä¸‹ã€‚</p>
<h3 id="1-1-1-ç¬¬ä¸€æ­¥ï¼Œç»‘å®š-this"><a href="#1-1-1-ç¬¬ä¸€æ­¥ï¼Œç»‘å®š-this" class="headerlink" title="1.1.1 ç¬¬ä¸€æ­¥ï¼Œç»‘å®š this"></a>1.1.1 ç¬¬ä¸€æ­¥ï¼Œç»‘å®š this</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">f.apply(o);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ä¸‹é¢ä»£ç çš„åŠŸèƒ½ç±»ä¼¼ï¼ˆå‡è®¾å¯¹è±¡oä¸­é¢„å…ˆä¸å­˜åœ¨åä¸ºmçš„å±æ€§ï¼‰ã€‚</span></span><br><span class="line">o.m=f; <span class="comment">//å°†få­˜å‚¨ä¸ºoçš„ä¸´æ—¶æ–¹æ³•</span></span><br><span class="line">o.m(); <span class="comment">//è°ƒç”¨å®ƒï¼Œä¸ä¼ å…¥å‚æ•°</span></span><br><span class="line"><span class="keyword">delete</span> o.m;<span class="comment">//å°†ä¸´æ—¶æ–¹æ³•åˆ é™¤</span></span><br></pre></td></tr></table></figure>
<p>(ä»¥ä¸Šä»£ç æ‘˜å½•è‡ªçŠ€ç‰›ä¹¦)<br>ä¾æ ·ç”»è‘«èŠ¦ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line">    context.__fn()</span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-1-2-ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°"><a href="#1-1-2-ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°" class="headerlink" title="1.1.2 ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°"></a>1.1.2 ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³åŠæ³•å®ç°ä¸€ä¸‹ apply çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚å…¶å®æˆ‘æœ€å¿«æƒ³åˆ°çš„æ˜¯ ES6 çš„æ–¹æ³•ã€‚ç”¨<code>...</code> ç›´æ¥å±•å¼€å°±è¡Œäº†ã€‚ä¸è¿‡ apply æ‰ ES3ğŸ˜‚ï¼Œè¿˜æ˜¯å†æƒ³æƒ³è€çš„åŠæ³•å§ã€‚</p>
<p>éš¾ç‚¹æ˜¯è¿™ä¸ªæ•°ç»„çš„é•¿åº¦æ˜¯ä¸ç¡®å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ²¡åŠæ³•å¾ˆå‡†ç¡®åœ°ç»™å‡½æ•°ä¸€ä¸ªä¸ªä¼ å‚ã€‚æˆ‘ä»¬æ‰€èƒ½åšçš„å¤„ç†ä¹Ÿå°±æ˜¯æŠŠ<code>arguments</code>è½¬æˆå­—ç¬¦ä¸²å½¢å¼<code>&#39;arguments[1], arguments[2], ...&#39;</code>ã€‚é‚£ä¹ˆå¦‚ä½•è®©å­—ç¬¦ä¸²èƒ½è¿è¡Œèµ·æ¥å‘¢ï¼Ÿï¼Ÿç­”æ¡ˆå°±æ˜¯ <code>eval</code>ï¼</p>
<p>ç¨ç¨æ€»ç»“ä¸€ä¸‹, ç›®å‰æƒ³åˆ°çš„ 2 ç§æ–¹æ³•</p>
<blockquote>
<ol>
<li>es6ã€‚<code>context.__fn(...arguments)</code></li>
<li>æŠŠ arguments è½¬æ¢æˆstringï¼Œæ”¾åˆ° eval é‡Œé¢è¿è¡Œ <code>eval(&#39;context.__fn(&#39;+ &#39;arguments[1], arguments[2]&#39; +&#39;)&#39;)</code></li>
</ol>
</blockquote>
<p>ä»¥ä¸‹æ˜¯ç¬¬äºŒç§æ€è·¯çš„ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, others</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="comment">// args: 'others[0], others[1], others[2], ...'</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = others.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'others['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-1-3-ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼"><a href="#1-1-3-ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼" class="headerlink" title="1.1.3 ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼"></a>1.1.3 ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼</h3><p>è¿”å›å‡½æ•°è°ƒç”¨åçš„ç»“æœå°±è¡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, others</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="comment">// args: 'others[0], others[1], others[2], ...'</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = others.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'others['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-1-4-æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„-this"><a href="#1-1-4-æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„-this" class="headerlink" title="1.1.4 æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„ this"></a>1.1.4 æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„ this</h3><p>æˆ‘ä»¬ä¹‹å‰æœ‰æåˆ°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°å¤„äºéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåˆ™æŒ‡å®šä¸º null æˆ– undefined æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºæŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œè€Œå…¶ä»–åŸå§‹å€¼åˆ™ä¼šè¢«ç›¸åº”çš„åŒ…è£…å¯¹è±¡ï¼ˆwrapper objectï¼‰æ‰€æ›¿ä»£</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, others</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> argsArray === <span class="string">'undefined'</span> || argsArray === <span class="literal">null</span>) &#123;</span><br><span class="line">        context = <span class="built_in">window</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// context æ˜¯ä¸€ä¸ª object</span></span><br><span class="line">    context = <span class="keyword">new</span> <span class="built_in">Object</span>(context)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = others.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'others['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-1-5-å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿-fn-ä¸å­˜åœ¨"><a href="#1-1-5-å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿-fn-ä¸å­˜åœ¨" class="headerlink" title="1.1.5 å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿ __fn ä¸å­˜åœ¨"></a>1.1.5 å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿ __fn ä¸å­˜åœ¨</h3><p>æˆ‘ä»¬ä¹‹å‰çš„ä»£ç éƒ½æ˜¯å»ºç«‹åœ¨ <code>__fn</code> ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆä¸‡ä¸€å­˜åœ¨å‘¢ï¼Ÿå› æ­¤æˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦æ‰¾ä¸€ä¸ª <code>context</code> ä¸­æ²¡æœ‰å­˜åœ¨è¿‡çš„å±æ€§ã€‚<br>ğŸ¤”æˆ‘ä»¬å¾ˆå¿«å¯ä»¥æƒ³åˆ° ES6 çš„ symbolã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åƒè¿™æ ·</span></span><br><span class="line"><span class="keyword">var</span> __fn = <span class="keyword">new</span> <span class="built_in">Symbol</span>()</span><br><span class="line">context[__fn] = <span class="keyword">this</span></span><br></pre></td></tr></table></figure>
<p>ğŸ¤”å¦‚æœä¸ç”¨ ES6ï¼Œé‚£ä¹ˆå¦ä¸€ç§æ–¹æ³•ï¼Œæ˜¯æ ¹æ® <a href="https://juejin.im/post/5bf6c79bf265da6142738b29#heading-4">è¿™ç¯‡æ–‡ç« </a>ä¸­æåˆ°çš„ï¼Œè‡ªå·±ç”¨ Math.random() æ¨¡æ‹Ÿå®ç°ç‹¬ä¸€æ— äºŒçš„ keyã€‚é¢è¯•æ—¶å¯ä»¥ç›´æ¥ç”¨ç”Ÿæˆæ—¶é—´æˆ³å³å¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆ UUID é€šç”¨å”¯ä¸€è¯†åˆ«ç </span></span><br><span class="line"><span class="comment">// å¤§æ¦‚ç”Ÿæˆ è¿™æ ·ä¸€ä¸² '18efca2d-6e25-42bf-a636-30b8f9f2de09'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateUUID</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, random;</span><br><span class="line">    <span class="keyword">var</span> uuid = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        random = <span class="built_in">Math</span>.random() * <span class="number">16</span> | <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (i === <span class="number">8</span> || i === <span class="number">12</span> || i === <span class="number">16</span> || i === <span class="number">20</span>) &#123;</span><br><span class="line">            uuid += <span class="string">'-'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        uuid += (i === <span class="number">12</span> ? <span class="number">4</span> : (i === <span class="number">16</span> ? (random &amp; <span class="number">3</span> | <span class="number">8</span>) : random))</span><br><span class="line">            .toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uuid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç®€å•å®ç°</span></span><br><span class="line"><span class="comment">// '__' + new Date().getTime();</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿™ä¸ªkeyä¸‡ä¸€è¿™å¯¹è±¡ä¸­è¿˜æ˜¯æœ‰ï¼Œä¸ºäº†ä¿é™©èµ·è§ï¼Œå¯ä»¥åšä¸€æ¬¡ç¼“å­˜æ“ä½œ(å°±æ˜¯å…ˆæŠŠä¹‹å‰çš„å€¼ä¿å­˜èµ·æ¥)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åƒè¿™æ ·</span></span><br><span class="line"><span class="keyword">var</span> originalvalue = context.__fn</span><br><span class="line"><span class="keyword">var</span> hasOriginalValue = context.hasOwnProperty(<span class="string">'__fn'</span>)</span><br><span class="line">context.__fn = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(hasOriginalValue)&#123;</span><br><span class="line">    context.__fn = originalvalue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="2-call"><a href="#2-call" class="headerlink" title="2. call"></a>2. call</h1><ul>
<li><p>å’Œ apply çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ <code>call()</code> æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œè€Œ <code>apply()</code> æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„ã€‚</p>
</li>
<li><p>ä¾‹å¦‚ <code>func.apply(obj, [1,2])</code> ç›¸å½“äº <code>func.call(obj, 1, 2)</code></p>
</li>
</ul>
<h2 id="2-1-å®ç°ä¸€ä¸ª-call"><a href="#2-1-å®ç°ä¸€ä¸ª-call" class="headerlink" title="2.1 å®ç°ä¸€ä¸ª call"></a>2.1 å®ç°ä¸€ä¸ª call</h2><p>æ€è·¯å’Œ apply ä¸€æ ·ã€‚å”¯ä¸€åŒºåˆ«å°±åœ¨äºå‚æ•°å½¢å¼ã€‚æˆ‘ä»¬æŒ‰ç…§ call çš„è¦æ±‚æ¥å¤„ç†å‚æ•°å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬ä» arguments[1] å¼€å§‹æ‹¼å°±å¥½äº†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'arguments['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-bind"><a href="#3-bind" class="headerlink" title="3. bind"></a>3. bind</h1><p>æˆ‘ä»¬å¸¸å°† bind å’Œä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•åŒºåˆ†å¼€ï¼Œæ˜¯å› ä¸º bind æ˜¯ ECMAScript 5 ä¸­çš„æ–¹æ³•ï¼Œä¸”é™¤äº†å°†å‡½æ•°ç»‘å®šè‡³ä¸€ä¸ªå¯¹è±¡å¤–è¿˜å¤šäº†ä¸€äº›ç‰¹ç‚¹ã€‚</p>
<ul>
<li><p><strong>bind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°</strong>ï¼Œåœ¨ bind() è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„ this è¢«æŒ‡å®šä¸º bind() çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„åˆå§‹å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">func.apply(obj, [<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="comment">// ç›¸å½“äº</span></span><br><span class="line">func.call(obj, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// ç›¸å½“äº</span></span><br><span class="line"><span class="keyword">var</span> boundFun = func.bind(obj, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">boundFun()</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥è¿™æ ·</span></span><br><span class="line"><span class="keyword">var</span> boundFun = func.bind(obj, <span class="number">1</span>)</span><br><span class="line">boundFun(<span class="number">2</span>)</span><br></pre></td></tr></table></figure></li>
<li><p><strong>ç»‘å®šå‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ new è¿ç®—ç¬¦æ„é€ </strong>ï¼Œå®ƒä¼šè¡¨ç°ä¸ºç›®æ ‡å‡½æ•°å·²ç»è¢«æ„å»ºå®Œæ¯•äº†ä¼¼çš„ã€‚æä¾›çš„ this å€¼ä¼šè¢«å¿½ç•¥ï¼Œä½†å‰ç½®å‚æ•°ä»ä¼šæä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚</p>
</li>
</ul>
<h2 id="3-1-å®ç°ä¸€ä¸ª-bind"><a href="#3-1-å®ç°ä¸€ä¸ª-bind" class="headerlink" title="3.1 å®ç°ä¸€ä¸ª bind"></a>3.1 å®ç°ä¸€ä¸ª bind</h2><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆå¤§è‡´æ€è€ƒä¸€ä¸‹è¯¥æ€ä¹ˆåšï¼š</p>
<ol>
<li>å®ç°ç¬¬ä¸€ä¸ªå‚æ•°çš„åŠŸèƒ½ï¼Œæ”¹å˜ this æŒ‡å‘ã€‚è¿™ä¸ªå’Œ apply/call æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚</li>
<li>å®ç°å…¶å®ƒå‚æ•°ã€‚å…¶å®ƒå‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„åˆå§‹å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚è¿™ä¸ªå’Œ call æœ‰äº›ç›¸ä¼¼ã€‚</li>
<li>ä½¿ç”¨ new æ“ä½œç¬¦æ—¶ï¼Œåº”è¯¥å¿½ç•¥ç¬¬ä¸€ä¸ªå‚æ•°</li>
</ol>
<p>åç»­çš„æ­¥éª¤æˆ‘ä¼šç”¨ apply/call æ¥å®ç°bindã€‚å¦‚æœä¸æƒ³ç›´æ¥ç”¨ apply/callï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§ä¸Šæ–‡å…ˆå®ç°ä¸€ä¸ª apply/callã€‚</p>
<h3 id="3-1-1-ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº†-this-çš„æ–°å‡½æ•°"><a href="#3-1-1-ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº†-this-çš„æ–°å‡½æ•°" class="headerlink" title="3.1.1 ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº† this çš„æ–°å‡½æ•°"></a>3.1.1 ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº† this çš„æ–°å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> self.apply(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°"><a href="#3-1-2-ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°" class="headerlink" title="3.1.2 ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°"></a>3.1.2 ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– bind å‡½æ•°ä»ç¬¬äºŒä¸ªå‚æ•°åˆ°æœ€åä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">var</span> initialArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªç»‘å®šå¥½ this çš„æ–°å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ˜¯è°ƒç”¨æ–°å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">var</span> boundArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">        <span class="comment">// æœ€ç»ˆçš„å‚æ•°åº”è¯¥æ˜¯åˆå§‹å‚æ•°+æ–°å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">return</span> self.apply(context, args.concat(bindArgs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„-this"><a href="#3-1-3-ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„-this" class="headerlink" title="3.1.3 ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„ this"></a>3.1.3 ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„ this</h3><p>è¿™é‡Œçš„éš¾ç‚¹æ˜¯æ€ä¹ˆçŸ¥é“æ˜¯ç”± new è°ƒç”¨çš„ã€‚<br>å…ˆè¯´ä¸€ä¸‹ç­”æ¡ˆå§</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡å¦‚æœ‰ä»¥ä¸‹å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¯¹äº <code>var gioia = new Person()</code> æ¥è¯´<br>ä½¿ç”¨ new æ—¶ï¼Œthis ä¼šæŒ‡å‘ gioiaï¼Œå¹¶ä¸” gioia æ˜¯ Person çš„å®ä¾‹ã€‚<br>å› æ­¤ï¼Œå¦‚æœ <code>this instance Person</code>ï¼Œå°±è¯´æ˜æ˜¯ new è°ƒç”¨çš„</p>
</blockquote>
<p>new è¿™ä¸€éƒ¨åˆ†è¿™é‡Œå…ˆä¸å±•å¼€è®²ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ <a href="https://github.com/mqyqingfeng/Blog/issues/13">JavaScriptæ·±å…¥ä¹‹newçš„æ¨¡æ‹Ÿå®ç°</a><br>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å†™ä»£ç äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– bind å‡½æ•°ä»ç¬¬äºŒä¸ªå‚æ•°åˆ°æœ€åä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">var</span> initialArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªç»‘å®šå¥½ this çš„æ–°å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Bound</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ˜¯è°ƒç”¨æ–°å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">var</span> boundArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">        <span class="comment">// æœ€ç»ˆçš„å‚æ•°åº”è¯¥æ˜¯åˆå§‹å‚æ•°+æ–°å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">return</span> self.apply(<span class="keyword">this</span> instance Bound ? <span class="keyword">this</span> : context, args.concat(bindArgs));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Bound.prototype = <span class="keyword">this</span>.prototype</span><br><span class="line">    <span class="keyword">return</span> Bound</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-å‚è€ƒæ–‡ç« "><a href="#4-å‚è€ƒæ–‡ç« " class="headerlink" title="4. å‚è€ƒæ–‡ç« "></a>4. å‚è€ƒæ–‡ç« </h1><ul>
<li><a href="https://juejin.im/post/5bf6c79bf265da6142738b29">é¢è¯•å®˜é—®ï¼šèƒ½å¦æ¨¡æ‹Ÿå®ç°JSçš„callå’Œapplyæ–¹æ³•</a></li>
<li><a href="https://juejin.im/post/5907eb99570c3500582ca23c">JavaScriptæ·±å…¥ä¹‹callå’Œapplyçš„æ¨¡æ‹Ÿå®ç°</a></li>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/12">JavaScriptæ·±å…¥ä¹‹bindçš„æ¨¡æ‹Ÿå®ç°</a></li>
</ul>
]]></content>
      <tags>
        <tag>this</tag>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>å†™ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·</title>
    <url>/2020/04/30/miniwebpack/</url>
    <content><![CDATA[<h1 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1. å‰è¨€"></a>1. å‰è¨€</h1><p>ä¸çŸ¥é“æœ‰æ²¡æœ‰äººå’Œæˆ‘ä¸€æ ·ï¼Œä¸ç®¡çœ‹äº†å‡ éæ–‡æ¡£ï¼Œè¿˜æ˜¯ä¸ä¼šè‡ªå·±å†™ webpackï¼Œåªèƒ½åœ¨åˆ«äººå†™çš„é…ç½®ä¸Šä¿®ä¿®è¡¥è¡¥ï¼Œæ›´åˆ«æä»€ä¹ˆä¼˜åŒ–äº†ã€‚<br>äºæ˜¯æˆ‘ç—›å®šæ€ç—›ï¼Œå†³å®šä»æºå¤´ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ä¸ºäº†æ›´å¥½åœ°åº”ç”¨ webpackï¼Œæˆ‘ä»¬åº”è¯¥äº†è§£å®ƒèƒŒåçš„å·¥ä½œåŸç†ã€‚<br>å› æ­¤ï¼Œæˆ‘é˜…è¯»äº† <a href="https://github.com/ronami/minipack/blob/master/src/minipack.js">miniwebpack</a> è¿™ä¸ªä»“åº“ã€‚è¿™ä¸ªä»“åº“å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„æ‰“åŒ…å·¥å…·ã€‚æ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§æˆ‘çš„ç†è§£æ¥è§£é‡Šä¸€ä¸‹æ€ä¹ˆå®ç°ä¸€ä¸ªç®€å•çš„æ‰“åŒ…å·¥å…·</p>
<a id="more"></a>

<h1 id="2-ä¸»è¦æ€è·¯"><a href="#2-ä¸»è¦æ€è·¯" class="headerlink" title="2. ä¸»è¦æ€è·¯"></a>2. ä¸»è¦æ€è·¯</h1><ol>
<li>ä»£ç å¤„ç†ã€‚æˆ‘ä»¬å¹³å¸¸å†™ä»£ç çš„æ—¶å€™ï¼Œç”¨çš„å¯èƒ½æ˜¯ES6ã€ES7ç­‰é«˜ç‰ˆæœ¬çš„è¯­æ³•ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬è½¬æ¢æˆæµè§ˆå™¨èƒ½è¿è¡Œçš„è¯­æ³•</li>
<li>æ‰“åŒ…ã€‚éœ€è¦æ ¹æ®ä¸€ä¸ª entry æ¥è¾“å‡ºä¸€ä¸ª outputï¼Œæˆ‘ä»¬é€šè¿‡ç»´æŠ¤ä¸€ä¸ªä¾èµ–å…³ç³»å›¾æ¥è§£å†³è¿™ä¸ªé—®é¢˜</li>
</ol>
<pre class="mermaid">graph LR
A[entry] --> |è§£æä»£ç | B[AST]
B --> |ç”Ÿæˆ| C[æµè§ˆå™¨å¯ç”¨ä»£ç ]
B --> |æ£€æŸ¥importå£°æ˜| D[ä¾èµ–]
C --> E[æ¨¡å—ä¿¡æ¯]
D --> E
E --> F[ä¾èµ–å…³ç³»å›¾]
F --> |ç”Ÿæˆæœ€ç»ˆä»£ç | G[output]</pre>

<h1 id="3-ä»£ç å¤„ç†"><a href="#3-ä»£ç å¤„ç†" class="headerlink" title="3. ä»£ç å¤„ç†"></a>3. ä»£ç å¤„ç†</h1><ol>
<li>è§£æï¼ˆparseï¼‰ã€‚å°†æºä»£ç å˜æˆASTã€‚</li>
<li>è½¬æ¢ï¼ˆtransformï¼‰ã€‚æ“ä½œASTï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥æ“ä½œçš„éƒ¨åˆ†ï¼Œå»æ”¹å˜ä»£ç ã€‚</li>
<li>ç”Ÿæˆï¼ˆgenerateï¼‰ã€‚å°†æ›´æ”¹åçš„ASTï¼Œå†å˜å›ä»£ç ã€‚  <blockquote>
<p>å‚è€ƒï¼š<a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-stages-of-babel">Babelç”¨æˆ·æ‰‹å†Œ</a></p>
</blockquote>
</li>
</ol>
<p>ä¸‹é¢æˆ‘å°†ä»‹ç»ä¸€äº›è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„å·¥å…·ã€‚</p>
<h2 id="3-1-è§£æå™¨-babylon"><a href="#3-1-è§£æå™¨-babylon" class="headerlink" title="3.1 è§£æå™¨ babylon"></a>3.1 è§£æå™¨ babylon</h2><p>ç”¨æ¥å°†æºä»£ç è½¬æ¢ä¸º ASTã€‚<br>ï¼ˆä¸äº†è§£ AST çš„ï¼Œå¯ä»¥å…ˆçœ‹çœ‹<a href="https://astexplorer.net/">åœ¨çº¿ASTè½¬æ¢å™¨</a>ã€‚ï¼‰</p>
<h3 id="3-1-1-å®‰è£…"><a href="#3-1-1-å®‰è£…" class="headerlink" title="3.1.1 å®‰è£…"></a>3.1.1 å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save babylon</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-ä½¿ç”¨"><a href="#3-1-2-ä½¿ç”¨" class="headerlink" title="3.1.2  ä½¿ç”¨"></a>3.1.2  ä½¿ç”¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> babylon <span class="keyword">from</span> <span class="string">"babylon"</span>;</span><br><span class="line"></span><br><span class="line">babylon.parse(code, [options])</span><br></pre></td></tr></table></figure>

<h2 id="3-2-è½¬æ¢å™¨-babel-traverse"><a href="#3-2-è½¬æ¢å™¨-babel-traverse" class="headerlink" title="3.2 è½¬æ¢å™¨ babel-traverse"></a>3.2 è½¬æ¢å™¨ babel-traverse</h2><p>ç”¨æ¥æ“ä½œ AST</p>
<h3 id="3-2-1-å®‰è£…"><a href="#3-2-1-å®‰è£…" class="headerlink" title="3.2.1 å®‰è£…"></a>3.2.1 å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save babel-traverse</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-ä½¿ç”¨"><a href="#3-2-2-ä½¿ç”¨" class="headerlink" title="3.2.2 ä½¿ç”¨"></a>3.2.2 ä½¿ç”¨</h3><p>è¯¥æ¨¡å—ä»…æš´éœ²å‡ºä¸€ä¸ª traverse æ–¹æ³•ã€‚traverse æ–¹æ³•æ˜¯ä¸€ä¸ªéå†æ–¹æ³•ï¼Œ path å°è£…äº†æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿˜æä¾›å®¹å™¨ container ï¼Œä½œç”¨åŸŸ scope è¿™æ ·çš„å­—æ®µã€‚æä¾›ä¸ªæ›´å¤šå…³äºèŠ‚ç‚¹çš„ç›¸å…³çš„ä¿¡æ¯ï¼Œè®©æˆ‘ä»¬æ›´å¥½çš„æ“ä½œèŠ‚ç‚¹ã€‚<br>ç¤ºä¾‹ï¼š  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">import</span> traverse <span class="keyword">from</span> <span class="string">"babel-traverse"</span>;</span><br><span class="line"></span><br><span class="line">traverse(ast, &#123;</span><br><span class="line">  enter(path) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.node.type === <span class="string">"Identifier"</span></span><br><span class="line">      &amp;&amp; path.node.name === <span class="string">'text'</span>) &#123;</span><br><span class="line">      path.node.name = <span class="string">'alteredText'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="3-3-ç”Ÿæˆå™¨-babel-generator"><a href="#3-3-ç”Ÿæˆå™¨-babel-generator" class="headerlink" title="3.3 ç”Ÿæˆå™¨ babel-generator"></a>3.3 ç”Ÿæˆå™¨ babel-generator</h2><p>å¯ä»¥æ ¹æ® AST ç”Ÿæˆä»£ç </p>
<h3 id="3-3-1-å®‰è£…"><a href="#3-3-1-å®‰è£…" class="headerlink" title="3.3.1 å®‰è£…"></a>3.3.1 å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save babel-generator</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-ä½¿ç”¨"><a href="#3-3-2-ä½¿ç”¨" class="headerlink" title="3.3.2 ä½¿ç”¨"></a>3.3.2 ä½¿ç”¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> generate <span class="keyword">from</span> <span class="string">"babel-generator"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> genCode = generate(ast, &#123;&#125;, code);</span><br></pre></td></tr></table></figure>

<h1 id="4-å®ç°ç»†èŠ‚"><a href="#4-å®ç°ç»†èŠ‚" class="headerlink" title="4. å®ç°ç»†èŠ‚"></a>4. å®ç°ç»†èŠ‚</h1><h2 id="4-1-ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–"><a href="#4-1-ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–" class="headerlink" title="4.1 ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–"></a>4.1 ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–</h2><p>æœ€å¼€å§‹æˆ‘ä»¬æåˆ°ï¼Œéœ€è¦æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾ã€‚é‚£ä¹ˆæˆ‘ä»¬å…ˆä»ç¬¬ä¸€æ­¥å¼€å§‹ï¼Œå®ç°æ ¹æ®æŸä¸ªæ–‡ä»¶ï¼ˆè¾“å…¥ç»å¯¹è·¯å¾„ï¼‰æå–ä¾èµ–ã€‚å¤§è‡´å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>è¯»å–æ–‡ä»¶å†…å®¹</li>
<li>ç”Ÿæˆ AST</li>
<li>éå† AST æ¥ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—</li>
<li>ä¸ºè¯¥æ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li>ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨</li>
</ol>
<h3 id="4-1-1-è¯»å–æ–‡ä»¶å†…å®¹"><a href="#4-1-1-è¯»å–æ–‡ä»¶å†…å®¹" class="headerlink" title="4.1.1 è¯»å–æ–‡ä»¶å†…å®¹"></a>4.1.1 è¯»å–æ–‡ä»¶å†…å®¹</h3><p>æˆ‘ä»¬ç”¨ node.js çš„ <code>fs</code> æ¨¡å—å°±å¯ä»¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> content = fs.readFileSync(filename, <span class="string">'utf-8'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4-1-2-ç”Ÿæˆ-AST"><a href="#4-1-2-ç”Ÿæˆ-AST" class="headerlink" title="4.1.2 ç”Ÿæˆ AST"></a>4.1.2 ç”Ÿæˆ AST</h3><p>ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ babylon</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ast = babylon.parse(content, &#123;</span><br><span class="line">  sourceType: <span class="string">'module'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-1-3-éå†-AST-æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—"><a href="#4-1-3-éå†-AST-æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—" class="headerlink" title="4.1.3 éå† AST æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—"></a>4.1.3 éå† AST æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—</h3><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ“ä½œ ASTï¼Œæ‰€ä»¥ç”¨åˆ° babel-traverse</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dependencies = [];</span><br><span class="line"><span class="comment">// è¦åšåˆ°è¿™ä¸€ç‚¹,æˆ‘ä»¬æ£€æŸ¥`ast`ä¸­çš„æ¯ä¸ª `import` å£°æ˜.</span></span><br><span class="line">traverse(ast, &#123;</span><br><span class="line"><span class="comment">// `Ecmascript`æ¨¡å—ç›¸å½“ç®€å•,å› ä¸ºå®ƒä»¬æ˜¯é™æ€çš„. è¿™æ„å‘³ç€ä½ ä¸èƒ½`import`ä¸€ä¸ªå˜é‡,</span></span><br><span class="line"><span class="comment">// æˆ–è€…æœ‰æ¡ä»¶åœ°`import`å¦ä¸€ä¸ªæ¨¡å—. </span></span><br><span class="line"><span class="comment">// æ¯æ¬¡æˆ‘ä»¬çœ‹åˆ°`import`å£°æ˜æ—¶,æˆ‘ä»¬éƒ½å¯ä»¥å°†å…¶æ•°å€¼è§†ä¸º`ä¾èµ–æ€§`.</span></span><br><span class="line">  ImportDeclaration: <span class="function">(<span class="params">&#123;node&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    dependencies.push(node.source.value);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="4-1-4-ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦"><a href="#4-1-4-ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦" class="headerlink" title="4.1.4 ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦"></a>4.1.4 ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦</h3><p>æˆ‘ä»¬ç®€å•åœ°ç”¨ id è¡¨ç¤º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; é€’å¢ç®€å•è®¡æ•°å™¨</span><br><span class="line">const id &#x3D; ID++;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-5-ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨"><a href="#4-1-5-ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨" class="headerlink" title="4.1.5 ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨"></a>4.1.5 ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨</h3><p>ä½¿ç”¨ <a href="https://www.babeljs.cn/docs/">babel</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;transformFromAst&#125; = <span class="built_in">require</span>(<span class="string">'babel-core'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯¥`presets`é€‰é¡¹æ˜¯ä¸€ç»„è§„åˆ™,å‘Šè¯‰`babel`å¦‚ä½•ä¼ è¾“æˆ‘ä»¬çš„ä»£ç . </span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬ç”¨`babel-preset-env``å°†æˆ‘ä»¬çš„ä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯ä»¥è¿è¡Œçš„ä¸œè¥¿. </span></span><br><span class="line"><span class="keyword">const</span> &#123;code&#125; = transformFromAst(ast, <span class="literal">null</span>, &#123;</span><br><span class="line">  presets: [<span class="string">'env'</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆ code åˆ°åº•é•¿ä»€ä¹ˆæ ·å‘¢</p>
<blockquote>
<ol>
<li>é¦–å…ˆï¼Œbabel èƒ½å°† es6 ç­‰æ›´æ–°çš„ä»£ç è½¬æˆæµè§ˆå™¨èƒ½æ‰§è¡Œçš„ä½ç‰ˆæœ¬ä»£ç ï¼Œè¿™ä¸ªä¹‹å‰ä¸€ç›´åœ¨å¼ºè°ƒçš„</li>
<li>å…¶æ¬¡ï¼Œå¯¹äºæ¨¡å—çš„è½¬æ¢ã€‚Babel å¯¹ ES6 æ¨¡å—è½¬ç å°±æ˜¯è½¬æ¢æˆ CommonJS è§„èŒƒ<br>Babel å¯¹äºæ¨¡å—è¾“å‡ºçš„è½¬æ¢ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰è¾“å‡ºéƒ½èµ‹å€¼åˆ° exports å¯¹è±¡çš„å±æ€§ä¸Šï¼Œå¹¶åŠ ä¸Š ESModule: true çš„æ ‡è¯†ã€‚è¡¨ç¤ºè¿™ä¸ªæ¨¡å—æ˜¯ç”± ESModule è½¬æ¢æ¥çš„ CommonJS è¾“å‡º<br>è¾“å…¥å°±æ˜¯ require</li>
</ol>
</blockquote>
<p>ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// entry.js</span></span><br><span class="line"><span class="keyword">import</span> message <span class="keyword">from</span> <span class="string">'./message.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message);</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="comment">// message.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;name&#125; <span class="keyword">from</span> <span class="string">'./name.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">`hello <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§ä¸Šé¢çš„è§„èŒƒï¼Œè½¬æ¢åçš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// entry.js</span></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> _message = <span class="built_in">require</span>(<span class="string">"./message.js"</span>);</span><br><span class="line"><span class="keyword">var</span> _message2 = _interopRequireDefault(_message);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_interopRequireDefault</span>(<span class="params">obj</span>) </span>&#123; </span><br><span class="line">  <span class="keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : &#123; <span class="attr">default</span>: obj &#125;; </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(_message2.default);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// message.js</span></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ ä¸Š ESModule: true çš„æ ‡è¯†</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">  value: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> _name = <span class="built_in">require</span>(<span class="string">"./name.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠæ‰€æœ‰è¾“å‡ºéƒ½èµ‹å€¼åˆ° exports å¯¹è±¡çš„å±æ€§ä¸Š</span></span><br><span class="line">exports.default = <span class="string">"hello "</span> + _name.name + <span class="string">"!"</span>;</span><br></pre></td></tr></table></figure>


<h3 id="4-1-6-è¿”å›æ¨¡å—ä¿¡æ¯"><a href="#4-1-6-è¿”å›æ¨¡å—ä¿¡æ¯" class="headerlink" title="4.1.6 è¿”å›æ¨¡å—ä¿¡æ¯"></a>4.1.6 è¿”å›æ¨¡å—ä¿¡æ¯</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  id,</span><br><span class="line">  filename,</span><br><span class="line">  dependencies,</span><br><span class="line">  code,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šï¼Œæˆ‘ä»¬å°±å¤„ç†å¥½äº†ä¸€ä¸ªæ¨¡å—ã€‚åŒ…å«ç€ä»¥ä¸‹ 4 é¡¹ä¿¡æ¯  </p>
<ul>
<li>æ¨¡å— id</li>
<li>æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</li>
<li>è¯¥æ¨¡å—çš„ä¾èµ–ã€‚ä¿å­˜ç€çš„æ˜¯ä¾èµ–ä»¬çš„ç›¸å¯¹è·¯å¾„</li>
<li>è¯¥æ¨¡å—å†…éƒ¨ä»£ç ï¼ˆæµè§ˆå™¨å¯è¿è¡Œï¼‰</li>
</ul>
<h2 id="4-2-ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾"><a href="#4-2-ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾" class="headerlink" title="4.2 ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾"></a>4.2 ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾</h2><p>é€šè¿‡ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»èƒ½ç”ŸæˆæŸä¸ªæ¨¡å—çš„ä¾èµ–äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é¡ºè—¤æ‘¸ç“œï¼Œä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œç”Ÿæˆå…¥å£æ–‡ä»¶çš„ä¾èµ–ï¼Œå†ç”Ÿæˆå…¥å£æ–‡ä»¶çš„ä¾èµ–çš„ä¾èµ–ï¼Œå†ç”Ÿæˆå…¥å£æ–‡ä»¶çš„ä¾èµ–çš„ä¾èµ–ä¾â€¦ï¼ˆç¦æ­¢å¥—å¨ƒï¼‰ï¼Œç›´åˆ°æ‰€æœ‰æ¨¡å—å¤„ç†å®Œæ¯•</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// entry ä¸ºå…¥å£æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createGraph</span>(<span class="params">entry</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// createAsset æ˜¯æˆ‘ä»¬åœ¨ã€ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–ã€‘ä¸­å®ç°çš„å‡½æ•°</span></span><br><span class="line">  <span class="comment">// mainAsset å°±æ˜¯å…¥å£æ¨¡å—çš„ä¿¡æ¯äº†</span></span><br><span class="line">  <span class="keyword">const</span> mainAsset = createAsset(entry);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆšå¼€å§‹åªæœ‰å…¥å£æ¨¡å—</span></span><br><span class="line">  <span class="keyword">const</span> queue = [mainAsset];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> asset <span class="keyword">of</span> queue) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// mapping ç”¨æ¥å°†ã€ä¾èµ–çš„ç›¸å¯¹è·¯å¾„ã€‘æ˜ å°„åˆ°ã€è¯¥ä¾èµ–çš„æ¨¡å— idã€‘</span></span><br><span class="line">    asset.mapping = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ¨¡å—æ‰€åœ¨çš„ç›®å½•. </span></span><br><span class="line">    <span class="keyword">const</span> dirname = path.dirname(asset.filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ¯ä¸€ä¸ªä¾èµ–ã€‚</span></span><br><span class="line">    asset.dependencies.forEach(<span class="function"><span class="params">relativePath</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¾—åˆ°ä¾èµ–çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">      <span class="keyword">const</span> absolutePath = path.join(dirname, relativePath);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¾—åˆ° child çš„æ¨¡å—ä¿¡æ¯</span></span><br><span class="line">      <span class="keyword">const</span> child = createAsset(absolutePath);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å°†ã€ä¾èµ–çš„ç›¸å¯¹è·¯å¾„ã€‘æ˜ å°„åˆ°ã€è¯¥ä¾èµ–çš„æ¨¡å— idã€‘</span></span><br><span class="line">      <span class="comment">// å› ä¸ºå¦‚æœä¸åšæ˜ å°„ã€‚æœ€ç»ˆæ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶åï¼Œç¼–ç æ—¶çš„ç›¸å¯¹è·¯å¾„å°±ä¸ç®¡ç”¨äº†ã€‚æˆ‘ä»¬å°±æ²¡æ³•çŸ¥é“åƒ require('./child') è¿™ç§ä»£ç åˆ°åº•åº”è¯¥åŠ è½½å“ªä¸€ä¸ªæ¨¡å—</span></span><br><span class="line">      asset.mapping[relativePath] = child.id;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æŠŠè¿™ä¸ªå­æ¨¡å—ä¹Ÿæ”¾è¿›é˜Ÿåˆ—é‡Œé¢</span></span><br><span class="line">      queue.push(child);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ°è¿™ä¸€æ­¥,é˜Ÿåˆ— å°±æ˜¯ä¸€ä¸ªåŒ…å«ç›®æ ‡åº”ç”¨ä¸­ æ¯ä¸ªæ¨¡å— çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">// å®é™…ä¸Šè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„ä¾èµ–å…³ç³»å›¾äº†</span></span><br><span class="line">  <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä»¥ä¸‹æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ./example/entry.js</span></span><br><span class="line"><span class="keyword">import</span> message <span class="keyword">from</span> <span class="string">'./message.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ./example/message.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;name&#125; <span class="keyword">from</span> <span class="string">'./name.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">`hello <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ./example/name.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">'world'</span>;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¤„ç†åçš„ä¾èµ–å…³ç³»å›¾åº”è¯¥æ˜¯è¿™æ ·çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    id: <span class="number">0</span>,</span><br><span class="line">    filename: <span class="string">'./example/entry.js'</span>,</span><br><span class="line">    dependencies: [<span class="string">'./message.js'</span>],</span><br><span class="line">    code: ,<span class="comment">// ç•¥</span></span><br><span class="line">    mapping: &#123;</span><br><span class="line">        <span class="string">'./message.js'</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    filename: <span class="string">'./example/message.js'</span>,</span><br><span class="line">    dependencies: [<span class="string">'./name.js'</span>],</span><br><span class="line">    code: ,<span class="comment">// ç•¥</span></span><br><span class="line">    mapping: &#123;</span><br><span class="line">        <span class="string">'./name.js'</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    filename: <span class="string">'./example/name.js'</span>,</span><br><span class="line">    dependencies: [],</span><br><span class="line">    code: ,<span class="comment">// ç•¥</span></span><br><span class="line">    mapping: &#123;&#125;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<h2 id="4-3-ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç "><a href="#4-3-ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç " class="headerlink" title="4.3 ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç "></a>4.3 ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç </h2><p>ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¾èµ–å›¾</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">graph: Module[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Module &#123;</span><br><span class="line">  id: <span class="built_in">number</span> <span class="comment">// æ¨¡å—idï¼›åœ¨ã€æå–æŸæ–‡ä»¶çš„ä¾èµ–ã€‘è¿™ä¸€æ­¥ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªé€’å¢çš„ id</span></span><br><span class="line">  filename: <span class="built_in">string</span> </span><br><span class="line">  dependencies: Module[]</span><br><span class="line">  code: <span class="built_in">string</span> <span class="comment">// è¯¥æ¨¡å—çš„ä»£ç ï¼ˆç»è¿‡è½¬æ¢çš„ï¼Œèƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼‰ </span></span><br><span class="line">  mapping: Record&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; <span class="comment">// å°†ä¾èµ–çš„ç›¸å¯¹è·¯å¾„è½¬æ¢æˆidã€‚æ˜¯æˆ‘ä»¬åœ¨ã€ç”Ÿæˆä¾èµ–å›¾ã€‘è¿™ä¸€æ­¥æ‰€åšçš„å·¥ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">æ—¢ç„¶å·²ç»åˆ°äº†è¿™ä¸€æ­¥äº†ï¼Œå°±è¯´æ˜æˆ‘ä»¬å¾—å¤„ç†ä¸€ä¸‹ `</span>code<span class="string">` äº†ã€‚åœ¨ã€ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨ã€‘è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œ`</span>code<span class="string">` æ˜¯ç¬¦åˆ CommonJS è§„èŒƒçš„ã€‚ä½†CommonJS ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªä¸œè¥¿ï¼Œæ˜¯æµè§ˆå™¨ä¸­æ²¡æœ‰çš„ï¼š  </span></span><br><span class="line"><span class="string">- require </span></span><br><span class="line"><span class="string">- module </span></span><br><span class="line"><span class="string">- exports  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°è¿™3ä¸ªä¸œè¥¿ï¼</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é¦–å…ˆæŠŠå’±ç›®å‰çš„æ¨¡å—ä¿¡æ¯æ•´åˆä¸€ä¸‹ï¼š</span></span><br><span class="line"><span class="string">- mapping æ˜¯è‚¯å®šè¦çš„ã€‚å› ä¸ºæˆ‘ä»¬æ¨¡å—çš„è¢«è½¬æ¢åä¼šé€šè¿‡ç›¸å¯¹è·¯å¾„æ¥è°ƒç”¨ require() ï¼Œè€Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¯¹åº”å»åŠ è½½å“ªä¸ªæ¨¡å—  </span></span><br><span class="line"><span class="string">- code éœ€è¦ç¨å¾®æ”¹ä¸€ä¸‹ã€‚æ¯ä¸ªæ¨¡å—çš„ä½œç”¨åŸŸåº”è¯¥æ˜¯ç‹¬ç«‹çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ”¹æˆè¿™æ ·ï¼š</span></span><br><span class="line"><span class="string">  `</span><span class="string">``</span>javascript</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="built_in">module</span>, exports</span>) </span>&#123; </span><br><span class="line">    &#123;code&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæŠŠæ‰€æœ‰è¿™æ ·çš„æ¨¡å—æ”¾åœ¨ modules ä¸­ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  &#123;0: [</span></span><br><span class="line"><span class="comment">    function (require, module, exports) &#123; </span></span><br><span class="line"><span class="comment">      &#123;code&#125;</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">    mapping: &#123;</span></span><br><span class="line"><span class="comment">      './message.js': 1</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  ]&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">modules: Record&lt;<span class="built_in">number</span>, [<span class="function">(<span class="params"><span class="built_in">require</span>, <span class="built_in">module</span>, exports</span>) =&gt;</span> <span class="built_in">any</span>, Record&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt;]&gt;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸»ç¨‹åºï¼Œæˆ‘ä»¬ä¸»ç¨‹åºè¦åšçš„å·¥ä½œæœ‰</p>
<ol>
<li>å®ç° <code>require</code>, <code>module</code>, <code>exports</code></li>
<li>é»˜è®¤è°ƒç”¨å…¥å£æ–‡ä»¶</li>
<li>è‡ªæ‰§è¡Œ</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">id</span>) </span>&#123; </span><br><span class="line">    <span class="comment">// ä» modules æ‹¿åˆ° ã€æ‰§è¡Œå‡½æ•°ã€‘å’Œã€mappingã€‘</span></span><br><span class="line">    <span class="keyword">const</span> [fn, mapping] = modules[id];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå·±å®ç°çš„ requireï¼Œå¯ä»¥æ ¹æ®ç›¸å¯¹è·¯å¾„åŠ è½½ä¾èµ–</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">localRequire</span>(<span class="params">name</span>) </span>&#123; </span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(mapping[name]); </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// // è‡ªå·±å®ç°çš„ module å’Œ exports</span></span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">module</span> = &#123; <span class="attr">exports</span> : &#123;&#125; &#125;;</span><br><span class="line"></span><br><span class="line">    fn(localRequire, <span class="built_in">module</span>, <span class="built_in">module</span>.exports); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è°ƒç”¨å…¥å£æ–‡ä»¶</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">&#125;)(modules)</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>webpack</tag>
        <tag>æ‰“åŒ…å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å®ç°ä¸€ä¸ªæ·±æ‹·è´</title>
    <url>/2020/05/01/deepcopy/</url>
    <content><![CDATA[<p>è¿™éƒ¨åˆ†æˆ‘æ˜¯çœ‹äº† <a href="https://github.com/lodash/lodash/blob/4.17.15/lodash.js#L11087">lodash</a> çš„ç›¸å…³æºç ï¼Œå®ƒçœŸçš„å®ç°å¾—éå¸¸å®Œæ•´ï¼<br>æ€»ç»“æˆä¸€å¥è¯ï¼Œå°±æ˜¯éœ€è¦è€ƒè™‘å¾ˆå¤šæ•°æ®ç±»å‹ï¼Œç„¶åé’ˆå¯¹è¿™äº›æ•°æ®ç±»å‹æ‹·è´å°±è¡Œäº†ğŸ˜</p>
<a id="more"></a>


<p>å¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´ï¼Œæˆ‘ä»¬åŸºæœ¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ€è·¯èµ°ï¼š  </p>
<ol>
<li>åˆå§‹åŒ–ã€‚å³è°ƒç”¨ç›¸åº”çš„æ„é€ å‡½æ•°</li>
<li>é€’å½’åœ°èµ‹å€¼</li>
<li>æœ‰å¾ªç¯å¼•ç”¨çš„è¯éœ€è¦å¤„ç†ä¸€ä¸‹</li>
</ol>
<h1 id="1-æ‹·è´åŸºæœ¬ç±»å‹"><a href="#1-æ‹·è´åŸºæœ¬ç±»å‹" class="headerlink" title="1. æ‹·è´åŸºæœ¬ç±»å‹"></a>1. æ‹·è´åŸºæœ¬ç±»å‹</h1><p>åŸºæœ¬ç±»å‹ç›´æ¥èµ‹å€¼å°±å¯ä»¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> type = <span class="keyword">typeof</span> value</span><br><span class="line">    <span class="keyword">return</span> value != <span class="literal">null</span> &amp;&amp; (type === <span class="string">'object'</span> || type === <span class="string">'function'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>æ¥ä¸‹æ¥æ˜¯æ€ä¹ˆæ‹·è´å¼•ç”¨ç±»å‹ã€‚æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ¥ä»‹ç»ï¼š</p>
<ol>
<li>æ•°ç»„</li>
<li>å‡½æ•°</li>
<li>å¯¹è±¡</li>
<li>ç‰¹æ®Šç±»å‹ã€‚Booleanã€Dateã€Mapã€Number ç­‰ç­‰</li>
</ol>
<p>å¦å¤–ï¼Œlodash è¿˜å®ç°äº† Bufferï¼ˆnode.jsï¼‰ç­‰æ‹·è´ï¼Œä½†æˆ‘å®é™…ç”¨å¾—ä¸å¤šï¼Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹çœ‹æºç ã€‚</p>
<h1 id="2-æ‹·è´æ•°ç»„"><a href="#2-æ‹·è´æ•°ç»„" class="headerlink" title="2. æ‹·è´æ•°ç»„"></a>2. æ‹·è´æ•°ç»„</h1><h2 id="2-1-åˆå§‹åŒ–"><a href="#2-1-åˆå§‹åŒ–" class="headerlink" title="2.1 åˆå§‹åŒ–"></a>2.1 åˆå§‹åŒ–</h2><p>å…ˆåˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸ºåŸæ•°ç»„é•¿åº¦çš„æ•°ç»„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¾…ç»­</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hasOwnProperty = <span class="built_in">Object</span>.prototype.hasOwnProperty</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCloneArray</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; length &#125; = array</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">new</span> array.constructor(length)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸º RegExp.prototype.exec() ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„æˆ– nullï¼Œè¿™ä¸ªæ•°ç»„é‡Œæœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼šinputã€index</span></span><br><span class="line">    <span class="comment">// ç±»ä¼¼ ["foo", index: 6, input: "table football, foosball", groups: undefined]</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (length &amp;&amp; <span class="keyword">typeof</span> array[<span class="number">0</span>] === <span class="string">'string'</span> &amp;&amp; hasOwnProperty.call(array, <span class="string">'index'</span>)) &#123;</span><br><span class="line">        result.index = array.index</span><br><span class="line">        result.input = array.input</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-èµ‹å€¼"><a href="#2-2-èµ‹å€¼" class="headerlink" title="2.2 èµ‹å€¼"></a>2.2 èµ‹å€¼</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; value.length; i++) &#123;</span><br><span class="line">            result[i] = deepClone(value[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-æ‹·è´å‡½æ•°"><a href="#3-æ‹·è´å‡½æ•°" class="headerlink" title="3. æ‹·è´å‡½æ•°"></a>3. æ‹·è´å‡½æ•°</h1><p>å‡½æ•°çš„æ‹·è´çš„è¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¿”å›ä¹‹å‰çš„å¼•ç”¨ã€‚  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isFunc = <span class="keyword">typeof</span> value === <span class="string">'function'</span></span><br><span class="line">        <span class="comment">// å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (isFunc) &#123;</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; value.length; i++) &#123;</span><br><span class="line">            result[i] = deepClone(value[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-æ‹·è´å¯¹è±¡"><a href="#4-æ‹·è´å¯¹è±¡" class="headerlink" title="4. æ‹·è´å¯¹è±¡"></a>4. æ‹·è´å¯¹è±¡</h1><p>åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åèµ‹å€¼ã€‚<br>è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ‹·è´åçš„å¯¹è±¡å’ŒåŸå¯¹è±¡çš„åŸå‹é“¾æ˜¯ä¸€æ ·çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    <span class="keyword">const</span> tag = getTag(value)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isFunc = <span class="keyword">typeof</span> value === <span class="string">'function'</span></span><br><span class="line">        <span class="comment">// å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (isFunc) &#123;</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯¹è±¡æˆ– arguments</span></span><br><span class="line">        <span class="keyword">if</span> (tag == <span class="string">'[object Object]'</span> || tag == <span class="string">'[object Arguments]'</span>) &#123;</span><br><span class="line">            result = initCloneObject(value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        <span class="comment">// æ•°ç»„èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; value.length; i++) &#123;</span><br><span class="line">            result[i] = deepClone(value[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(<span class="built_in">Object</span>(value)).forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">            result[k] = deepClone(value[k])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èƒ½æ›´ç»†è‡´åœ°åˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTag</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value === <span class="literal">undefined</span> ? <span class="string">'[object Undefined]'</span> : <span class="string">'[object Null]'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> toString.call(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objectProto = <span class="built_in">Object</span>.prototype</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrototype</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Ctor = value &amp;&amp; value.constructor</span><br><span class="line">    <span class="keyword">const</span> proto = (<span class="keyword">typeof</span> Ctor === <span class="string">'function'</span> &amp;&amp; Ctor.prototype) || objectProto</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> value === proto</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCloneObject</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> object.constructor === <span class="string">'function'</span> &amp;&amp; !isPrototype(object))</span><br><span class="line">      ? <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.getPrototypeOf(object))</span><br><span class="line">      : &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-æ‹·è´ç‰¹æ®Šå¯¹è±¡"><a href="#5-æ‹·è´ç‰¹æ®Šå¯¹è±¡" class="headerlink" title="5. æ‹·è´ç‰¹æ®Šå¯¹è±¡"></a>5. æ‹·è´ç‰¹æ®Šå¯¹è±¡</h1><p>åŒ…æ‹¬ <code>Boolean</code>, <code>Date</code>, <code>Map</code>, <code>Number</code>, <code>RegExp</code>, <code>Set</code>,  <code>String</code>, <code>Symbol</code></p>
<p>æ¥ä¸‹æ¥çš„æ€è·¯ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå…ˆè°ƒç”¨å¯¹åº”çš„æ„é€ å‡½æ•°ã€‚ç„¶åèµ‹å€¼å°±è¡Œäº†ã€‚ç¨å¾®éº»çƒ¦ä¸€ç‚¹çš„å¯èƒ½æ˜¯ Regexp æ­£åˆ™å¯¹è±¡å’Œ Symbol å¯¹è±¡</p>
<h2 id="5-1-åˆå§‹åŒ–"><a href="#5-1-åˆå§‹åŒ–" class="headerlink" title="5.1 åˆå§‹åŒ–"></a>5.1 åˆå§‹åŒ–</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    <span class="keyword">const</span> tag = getTag(value)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isFunc = <span class="keyword">typeof</span> value === <span class="string">'function'</span></span><br><span class="line">        <span class="comment">// å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (isFunc) &#123;</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¯¹è±¡æˆ– arguments</span></span><br><span class="line">        <span class="keyword">if</span> (tag == <span class="string">'[object Object]'</span> || tag == <span class="string">'[object Arguments]'</span>) &#123;</span><br><span class="line">            result = initCloneObject(value)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ç‰¹æ®Šå¯¹è±¡çš„åˆå§‹åŒ–</span></span><br><span class="line">            result = initCloneByTag(value, tag)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        <span class="comment">// æ•°ç»„èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; value.length; i++) &#123;</span><br><span class="line">            result[i] = deepClone(value[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(<span class="built_in">Object</span>(value)).forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">            result[k] = deepClone(value[k])</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toString = <span class="built_in">Object</span>.prototype.toString</span><br><span class="line"><span class="comment">// èƒ½æ›´ç»†è‡´åœ°åˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTag</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> value === <span class="literal">undefined</span> ? <span class="string">'[object Undefined]'</span> : <span class="string">'[object Null]'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> toString.call(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objectProto = <span class="built_in">Object</span>.prototype</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrototype</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Ctor = value &amp;&amp; value.constructor</span><br><span class="line">    <span class="keyword">const</span> proto = (<span class="keyword">typeof</span> Ctor === <span class="string">'function'</span> &amp;&amp; Ctor.prototype) || objectProto</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> value === proto</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹æ®Šå¯¹è±¡çš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCloneByTag</span>(<span class="params">object, tag, isDeep</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Ctor = object.constructor</span><br><span class="line">    <span class="keyword">switch</span> (tag) &#123;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object Boolean]'</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object Date]'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Ctor(+object)</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object Set]'</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object Map]'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Ctor</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object Number]'</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object String]'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Ctor(object)</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object RegExp]'</span>:</span><br><span class="line">        <span class="keyword">return</span> cloneRegExp(object)</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">case</span> <span class="string">'[object Symbol]'</span>:</span><br><span class="line">        <span class="keyword">return</span> cloneSymbol(object)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reFlags = <span class="regexp">/\w*$/</span></span><br><span class="line"><span class="comment">// æ‹·è´ä¸€ä¸ªæ­£åˆ™</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneRegExp</span>(<span class="params">regexp</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// RegExp æ„é€ å‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ã€‚patternï¼ˆæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬ã€‚ï¼‰ï¼Œflagsï¼ˆæ ‡å¿—ï¼‰</span></span><br><span class="line">    <span class="comment">// source å±æ€§è¿”å›ä¸€ä¸ªå€¼ä¸ºå½“å‰æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡çš„æ¨¡å¼æ–‡æœ¬çš„å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²ä¸ä¼šåŒ…å«æ­£åˆ™å­—é¢é‡ä¸¤è¾¹çš„æ–œæ ä»¥åŠä»»ä½•çš„æ ‡å¿—å­—ç¬¦ã€‚</span></span><br><span class="line">    <span class="comment">// reFlags.exec(regexp) å®é™…ä¸Šæ˜¯ reFlags.exec(regexp.toString())ã€‚æå–å‡ºäº†æ ‡å¿—å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">new</span> regexp.constructor(regexp.source, reFlags.exec(regexp))</span><br><span class="line">    result.lastIndex = regexp.lastIndex</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> symbolValueOf = <span class="built_in">Symbol</span>.prototype.valueOf</span><br><span class="line"><span class="comment">// æ‹·è´ä¸€ä¸ª Symbol</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cloneSymbol</span>(<span class="params">symbol</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>(symbolValueOf.call(symbol))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-èµ‹å€¼"><a href="#5-2-èµ‹å€¼" class="headerlink" title="5.2 èµ‹å€¼"></a>5.2 èµ‹å€¼</h2><p>è™½ç„¶æ˜¯ç‰¹æ®Šå¯¹è±¡ï¼Œä½†ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯è¿˜æ˜¯è·å–è¯¥å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œç„¶åèµ‹å€¼å°±å¯ä»¥äº†ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯  </p>
<ol>
<li><code>Object.keys</code> ä¸èƒ½è·å– Symbol å±æ€§ï¼Œå¯ä»¥å†åŠ ä¸Š <code>Object.getOwnPropertySymbols()</code>æ¥è·å–æ‰€æœ‰ Symbol å±æ€§å  </li>
<li>Set å’Œ Map çš„èµ‹å€¼æ˜¯é€šè¿‡ add å’Œ set æ¥çš„</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    <span class="keyword">const</span> tag = getTag(value)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isFunc = <span class="keyword">typeof</span> value === <span class="string">'function'</span></span><br><span class="line">        <span class="comment">// å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (isFunc) &#123;</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¯¹è±¡æˆ– arguments</span></span><br><span class="line">        <span class="keyword">if</span> (tag == <span class="string">'[object Object]'</span> || tag == <span class="string">'[object Arguments]'</span>) &#123;</span><br><span class="line">            result = initCloneObject(value)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ç‰¹æ®Šå¯¹è±¡çš„åˆå§‹åŒ–</span></span><br><span class="line">            result = initCloneByTag(value, tag)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Map èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (tag === mapTag) &#123;</span><br><span class="line">        value.forEach(<span class="function">(<span class="params">subValue, key</span>) =&gt;</span> &#123;</span><br><span class="line">            result.set(key, deepClone(subValue))</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (tag === setTag) &#123;</span><br><span class="line">        value.forEach(<span class="function">(<span class="params">subValue</span>) =&gt;</span> &#123;</span><br><span class="line">            result.add(deepClone(subValue))</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        <span class="comment">// æ•°ç»„èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; value.length; i++) &#123;</span><br><span class="line">            result[i] = deepClone(value[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(<span class="built_in">Object</span>(value)).forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">            result[k] = deepClone(value[k])</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> propertyIsEnumerable = <span class="built_in">Object</span>.prototype.propertyIsEnumerable</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿‡æ»¤æ‰ä¸å¯æšä¸¾çš„ Symbol å±æ€§å¹¶èµ‹å€¼</span></span><br><span class="line">        <span class="built_in">Object</span>.getOwnPropertySymbols(value)</span><br><span class="line">            .filter(<span class="function">(<span class="params">symbol</span>) =&gt;</span> propertyIsEnumerable.call(value, symbol))</span><br><span class="line">            .forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">                result[k] = deepClone(value[k])</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="6-æµ‹è¯•"><a href="#6-æµ‹è¯•" class="headerlink" title="6. æµ‹è¯•"></a>6. æµ‹è¯•</h1><div class="tabs" id="[test]"><ul class="nav-tabs"><li class="tab active"><a href="#[test]-1">test</a></li><li class="tab"><a href="#[test]-2">result</a></li></ul><div class="tab-content"><div class="tab-pane active" id="[test]-1"><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">set</span> = new Set()</span><br><span class="line"><span class="keyword">set</span>.add('gioia')</span><br><span class="line"><span class="keyword">set</span>.add('me')</span><br><span class="line"></span><br><span class="line">const map = new Map()</span><br><span class="line">map.<span class="keyword">set</span>(0, 'zero')</span><br><span class="line">map.<span class="keyword">set</span>(1, 'one')</span><br><span class="line"></span><br><span class="line">const original = &#123;</span><br><span class="line">  name: <span class="string">'gioia'</span>,</span><br><span class="line">  getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="built_in">Symbol</span>()]: <span class="string">'symbol prop'</span>,</span><br><span class="line">  sym: <span class="built_in">Symbol</span>(<span class="string">'symbol value'</span>),</span><br><span class="line">  friends: [&#123;</span><br><span class="line">    name: <span class="string">'xkld'</span>,</span><br><span class="line">  &#125;, <span class="string">'cln'</span>],</span><br><span class="line">  dress: &#123;</span><br><span class="line">    pants: &#123;</span><br><span class="line">      color: <span class="string">'black'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    shirts: &#123;</span><br><span class="line">      colors: [<span class="string">'blue'</span>, <span class="string">'white'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  map: map,</span><br><span class="line">  <span class="keyword">set</span>: <span class="keyword">set</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const copy = deepClone(original)</span><br><span class="line">console.log(copy)</span><br><span class="line">console.log(copy.sym === original.sym)</span><br><span class="line">console.log(copy.friends === original.friends)</span><br><span class="line">console.log(copy.map === original.map)</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="[test]-2"><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: <span class="string">'gioia'</span>,</span><br><span class="line">  getName: [<span class="built_in">Function</span>: getName],</span><br><span class="line">  sym: <span class="built_in">Symbol</span>(symbol value),</span><br><span class="line">  friends: [ &#123; <span class="attr">name</span>: <span class="string">'xkld'</span> &#125;, <span class="string">'cln'</span> ],</span><br><span class="line">  dress: &#123; <span class="attr">pants</span>: &#123; <span class="attr">color</span>: <span class="string">'black'</span> &#125;, <span class="attr">shirts</span>: &#123; <span class="attr">colors</span>: [ <span class="string">'blue'</span>, <span class="string">'white'</span> ] &#125; &#125;,</span><br><span class="line">  map: <span class="built_in">Map</span> &#123; <span class="number">0</span> =&gt; <span class="string">'zero'</span>, <span class="number">1</span> =&gt; <span class="string">'one'</span> &#125;,</span><br><span class="line">  <span class="keyword">set</span>: Set &#123; <span class="string">'gioia'</span>, <span class="string">'me'</span> &#125;,</span><br><span class="line">  [<span class="built_in">Symbol</span>()]: <span class="string">'symbol prop'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="literal">false</span></span><br><span class="line"><span class="literal">false</span></span><br></pre></td></tr></table></figure></div></div></div>

<h1 id="7-è§£å†³å¾ªç¯å¼•ç”¨"><a href="#7-è§£å†³å¾ªç¯å¼•ç”¨" class="headerlink" title="7. è§£å†³å¾ªç¯å¼•ç”¨"></a>7. è§£å†³å¾ªç¯å¼•ç”¨</h1><p>ä»¥ä¸Šæˆ‘ä»¬å·²ç»åˆæ­¥å®ç°äº†ä¸€ä¸ªæ·±æ‹·è´äº†ã€‚ä½†æ˜¯åœ¨å¾ªç¯å¼•ç”¨çš„åœºæ™¯ä¸‹ï¼Œä¼šå‡ºç°æ ˆæº¢å‡ºçš„ç°è±¡ã€‚<br>ä¾‹å¦‚ <code>original.circle = original</code> è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¦æ˜¯è¿˜é€’å½’åœ°èµ‹å€¼çš„è¯ï¼Œå°±æ°¸è¿œä¹Ÿæ²¡æœ‰å°½å¤´ğŸ¥±<br>è§£å†³åŠæ³•å°±æ˜¯ï¼Œçœ‹çœ‹æˆ‘ä»¬è¦æ‹·è´çš„å¯¹è±¡ä¹‹å‰æœ‰æ²¡æœ‰å¤„ç†è¿‡ï¼Œæœ‰çš„è¯å°±ç›´æ¥å¼•ç”¨å°±è¡Œäº†ï¼›æ²¡æœ‰çš„è¯å†è¿›è¡Œèµ‹å€¼å¹¶è®°å½•åœ¨æ¡ˆã€‚ä½ å¯ä»¥é€‰æ‹©å¾ˆå¤šå­˜å‚¨æ–¹æ¡ˆï¼Œåƒ Mapï¼Œåªè¦èƒ½è®°å½•é”®å€¼å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    <span class="keyword">const</span> tag = getTag(value)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isFunc = <span class="keyword">typeof</span> value === <span class="string">'function'</span></span><br><span class="line">        <span class="comment">// å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (isFunc) &#123;</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">// å¯¹è±¡æˆ– arguments</span></span><br><span class="line">        <span class="keyword">if</span> (tag == <span class="string">'[object Object]'</span> || tag == <span class="string">'[object Arguments]'</span>) &#123;</span><br><span class="line">            result = initCloneObject(value)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// ç‰¹æ®Šå¯¹è±¡çš„åˆå§‹åŒ–</span></span><br><span class="line">            result = initCloneByTag(value, tag)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ£€æŸ¥å¾ªç¯å¼•ç”¨å¹¶è¿”å›å…¶å¯¹åº”çš„æ‹·è´</span></span><br><span class="line">    cache || (cache = <span class="keyword">new</span> <span class="built_in">Map</span>())</span><br><span class="line">    <span class="keyword">const</span> cached = cache.get(value)</span><br><span class="line">    <span class="keyword">if</span> (cached) &#123;</span><br><span class="line">        <span class="keyword">return</span> cached</span><br><span class="line">    &#125;</span><br><span class="line">    cache.set(value, result)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Map èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (tag === mapTag) &#123;</span><br><span class="line">        value.forEach(<span class="function">(<span class="params">subValue, key</span>) =&gt;</span> &#123;</span><br><span class="line">            result.set(key, deepClone(subValue))</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (tag === setTag) &#123;</span><br><span class="line">        value.forEach(<span class="function">(<span class="params">subValue</span>) =&gt;</span> &#123;</span><br><span class="line">            result.add(deepClone(subValue))</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        <span class="comment">// æ•°ç»„èµ‹å€¼</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; value.length; i++) &#123;</span><br><span class="line">            result[i] = deepClone(value[i])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹è±¡èµ‹å€¼</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(<span class="built_in">Object</span>(value)).forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">            result[k] = deepClone(value[k])</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> propertyIsEnumerable = <span class="built_in">Object</span>.prototype.propertyIsEnumerable</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿‡æ»¤æ‰ä¸å¯æšä¸¾çš„ Symbol å±æ€§å¹¶èµ‹å€¼</span></span><br><span class="line">        <span class="built_in">Object</span>.getOwnPropertySymbols(value)</span><br><span class="line">            .filter(<span class="function">(<span class="params">symbol</span>) =&gt;</span> propertyIsEnumerable.call(value, symbol))</span><br><span class="line">            .forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">                result[k] = deepClone(value[k])</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>WIP:è®²è®²æˆ‘ç†è§£çš„åŸå‹</title>
    <url>/2020/05/05/prototype/</url>
    <content><![CDATA[<h1 id="1-åŸå‹"><a href="#1-åŸå‹" class="headerlink" title="1. åŸå‹"></a>1. åŸå‹</h1><p>æˆ‘ä»¬åº”è¯¥ç›¸å¯¹ç‹¬ç«‹åœ°æ¥çœ‹åŸå‹è¿™ä¸ªæ¦‚å¿µã€‚<br>å¾ˆå¤šäººä¼šæŠŠåŸå‹çœ‹å¾—å¾ˆå¤æ‚ï¼Œå®é™…ä¸Šå®ƒåªæ˜¯ã€èƒ½ç»™å…¶å®ƒå¯¹è±¡æä¾›å…±äº«å±æ€§çš„å¯¹è±¡ã€‘ã€‚<br>å¥½æ¯”éƒ­å¾·çº²å’Œéƒ­éº’éºŸã€‚é¦–å…ˆè¿™ä¿©éƒ½æ˜¯äººï¼ˆå¯¹è±¡ï¼‰ï¼Œå…¶æ¬¡éƒ­å¾·çº²ç»™éƒ­éº’éºŸæä¾›äº†ç›¸å£°æ•™å­¦ç­‰â€œå…±äº«å±æ€§â€ï¼Œæ‰€ä»¥éƒ­å¾·çº²æ˜¯ä¸€ä¸ªâ€œåŸå‹â€ã€‚  </p>
<a id="more"></a>

<h2 id="1-1-éšå¼å¼•ç”¨"><a href="#1-1-éšå¼å¼•ç”¨" class="headerlink" title="1.1 éšå¼å¼•ç”¨"></a>1.1 éšå¼å¼•ç”¨</h2><ul>
<li>åœ¨è®¸å¤šæµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹è±¡çš„ <code>__proto__</code>å±æ€§æ¥è®¿é—®è¯¥å¯¹è±¡çš„åŸå‹ã€‚<br>ï¼ˆå…³äº <code>__proto__</code> çš„å†å²é—®é¢˜æˆ‘ä¸å±•å¼€è®²äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹çœ‹ç¬¬ä¸€ç¯‡å‚è€ƒæ–‡ç« ã€‚ï¼‰<br>è¿˜æ˜¯ç”¨éƒ­å¾·çº²éƒ­éº’éºŸæ¥ä¸¾ä¾‹å­ã€‚æˆ‘ä»¬å‡è£…éƒ­å¾·çº²çš„å„¿å­ä»¬å…³ç³»ç½‘é‡Œéƒ½æœ‰åå­—å«<code>__çˆ¸çˆ¸__</code>çš„äººï¼ŒæŒ‡å‘çš„æ˜¯éƒ­å¾·çº²ã€‚é‚£æˆ‘ä»¬è®¿é—® <code>éƒ­éº’éºŸ.__çˆ¸çˆ¸__</code>ä¸å°±å¯ä»¥æ‰¾åˆ°éƒ­å¾·çº²äº†å˜›ï¼Ÿï¼  </li>
<li>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®å¯¹è±¡çš„ <code>__proto__</code> æ¥ç›´æ¥è®¾ç½®åŸå‹<br>è¿™å°±å¥½åƒéƒ­å¾·çº²ç°åœ¨åˆç”Ÿäº†ä¸ªå„¿å­ï¼Œä»–éœ€è¦åœ¨æˆ·å£æœ¬ä¸ŠåŠ ä¸Šä¸€äº›ä¿¡æ¯ï¼š <code>æ–°å„¿å­.__çˆ¸çˆ¸__ = éƒ­å¾·çº²</code></li>
</ul>
<h1 id="2-ç»§æ‰¿"><a href="#2-ç»§æ‰¿" class="headerlink" title="2. ç»§æ‰¿"></a>2. ç»§æ‰¿</h1><blockquote>
<p>å¯¹äºä½¿ç”¨è¿‡åŸºäºç±»çš„è¯­è¨€ (å¦‚ Java æˆ– C++) çš„å¼€å‘äººå‘˜æ¥è¯´ï¼ŒJavaScript æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œå› ä¸ºå®ƒæ˜¯åŠ¨æ€çš„ï¼Œå¹¶ä¸”æœ¬èº«ä¸æä¾›ä¸€ä¸ª class å®ç°ã€‚ï¼ˆåœ¨ ES2015/ES6 ä¸­å¼•å…¥äº† class å…³é”®å­—ï¼Œä½†é‚£åªæ˜¯è¯­æ³•ç³–ï¼ŒJavaScript ä»ç„¶æ˜¯åŸºäºåŸå‹çš„ï¼‰ã€‚  </p>
<p>å½“è°ˆåˆ°ç»§æ‰¿æ—¶ï¼ŒJavaScript åªæœ‰ä¸€ç§ç»“æ„ï¼šå¯¹è±¡ã€‚æ¯ä¸ªå®ä¾‹å¯¹è±¡ï¼ˆ object ï¼‰éƒ½æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼ˆç§°ä¹‹ä¸º <code>__proto__</code>ï¼‰æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼ˆprototype ï¼‰ã€‚  </p>
<p>(æ¥è‡ª <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain">MDN</a>)</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œç»§æ‰¿æ„å‘³ç€â€œçˆ¸çˆ¸æœ‰çš„æˆ‘ä¹Ÿæœ‰ï¼â€ã€‚è€Œè¿™ä¸€ç‚¹åœ¨ JS ä¸­æ˜¯é€šè¿‡åŸå‹æ¥å®ç°çš„ã€‚  </p>
<h2 id="2-1-åˆ†ç±»"><a href="#2-1-åˆ†ç±»" class="headerlink" title="2.1 åˆ†ç±»"></a>2.1 åˆ†ç±»</h2><h3 id="2-1-1-æ˜¾å¼ç»§æ‰¿"><a href="#2-1-1-æ˜¾å¼ç»§æ‰¿" class="headerlink" title="2.1.1 æ˜¾å¼ç»§æ‰¿"></a>2.1.1 æ˜¾å¼ç»§æ‰¿</h3><p>æ—¢ç„¶ç»§æ‰¿æ˜¯ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„äº‹æƒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‰‹åŠ¨ç»™å¯¹è±¡è®¾ç½®åŸå‹å°±å¯ä»¥å®ç°ç»§æ‰¿ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> gdg = &#123; </span><br><span class="line">    <span class="string">'è¯´ç›¸å£°'</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'æˆ‘ä¼šè¯´ç›¸å£°'</span>)</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> gql = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰‹åŠ¨è®¾ç½®â€œ__proto__â€</span></span><br><span class="line">gql.__proto__ = gdg</span><br><span class="line"></span><br><span class="line"><span class="comment">// çˆ¸çˆ¸çš„â€œè¯´ç›¸å£°â€æˆ‘ä¹Ÿæœ‰ï¼</span></span><br><span class="line">gql[<span class="string">'è¯´ç›¸å£°'</span>]()</span><br></pre></td></tr></table></figure>

<h3 id="2-1-2-éšå¼ç»§æ‰¿ï¼ˆæ„é€ å‡½æ•°ç»§æ‰¿ï¼‰"><a href="#2-1-2-éšå¼ç»§æ‰¿ï¼ˆæ„é€ å‡½æ•°ç»§æ‰¿ï¼‰" class="headerlink" title="2.1.2 éšå¼ç»§æ‰¿ï¼ˆæ„é€ å‡½æ•°ç»§æ‰¿ï¼‰"></a>2.1.2 éšå¼ç»§æ‰¿ï¼ˆæ„é€ å‡½æ•°ç»§æ‰¿ï¼‰</h3><p>æ˜¾ç¤ºç»§æ‰¿è¦æ±‚æˆ‘ä»¬æœ‰ 2 ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ã€‚  </p>
<p>ä½†éšå¼ç»§æ‰¿ä¸ç”¨æ‰‹åŠ¨æ–°å»ºä¸€ä¸ªåŸå‹å¯¹è±¡ï¼Œåªéœ€é€šè¿‡â€œæ„é€ å‡½æ•°â€å°±èƒ½å¿«é€Ÿå®ç°ç»§æ‰¿ã€‚ä¸è¿‡è¿™åŸç†è¿˜æ˜¯<code>__proto__</code>ï¼Œåªä¸è¿‡å®ƒæ‚„å’ªå’ªç»™ä½ æ“ä½œå¥½äº†ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ—¶å€™æ— ç—›å½“çˆ¹ï¼Œå¯Ÿè§‰ä¸å‡ºæ¥è€Œå·²ã€‚  </p>
<p><strong>æ¯ä¸ªå‡½æ•°ï¼Œéƒ½é»˜è®¤æœ‰ä¸€ä¸ªåŸå‹</strong>ï¼Œå¯ä»¥é€šè¿‡ <code>function.prototype</code> è®¿é—®åˆ°ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>new</code> è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œå°±é»˜è®¤ç»§æ‰¿äº†è¿™ä¸ªåŸå‹</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">    <span class="keyword">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> gdg = <span class="keyword">new</span> Person(<span class="string">'éƒ­å¾·çº²'</span>, <span class="number">50</span>) <span class="comment">// è‡ªåŠ¨ç»§æ‰¿äº†Person.prototype</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘è®°å¾—æˆ‘æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´æä¸æ¸…æ¥š <code>prototype</code> å’Œ <code>__proto__</code>ã€‚å®é™…ä¸Šç»§æ‰¿æœ¬è´¨ä¸Šæ˜¯ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œä¸­é—´å¯ä»¥æ²¡æœ‰æ„é€ å‡½æ•°ã€‚æˆ‘ä»¬åŠ ä¸Š <code>Person</code> è¿™ä¸ªå‡½æ•°ï¼Œä½†æœ€ç»ˆæˆ‘ä»¬è¦ç”¨åˆ°çš„æ˜¯ <code>Person.prototype</code> è¿™ä¸ªå¯¹è±¡ã€‚<br>è¿™å°±å¥½åƒ <code>éƒ­éº’éºŸ.__çˆ¸çˆ¸__ = éƒ­éº’éºŸå¦ˆå¦ˆ.è€å…¬</code>ï¼ˆ<code>gql.__proto__ = GQLMM.prototype</code>ï¼‰<br>å› æ­¤ï¼Œéšå¼ç»§æ‰¿å°±æ˜¯å¦ˆå¦ˆç”Ÿäº†ä¸€ä¸ªå­©å­ï¼Œ<code>ç”Ÿçš„å­©å­.__çˆ¸çˆ¸__ = å¦ˆå¦ˆ.è€å…¬</code>ï¼›æ˜¾ç¤ºç»§æ‰¿æœ‰ç‚¹åƒç›´æ¥æŠ±å…»ä¸€ä¸ªå­©å­ï¼Œç›´æ¥æŠŠ<code>å„¿å­.__çˆ¸çˆ¸__</code>æ”¹æ‰å°±è¡Œäº†  </p>
<p>å¦å¤–ï¼Œæ¯ä¸ªå‡½æ•°çš„ <code>prototype</code> ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ—¢ç„¶æ˜¯å¯¹è±¡å°±æœ‰<code>__proto__</code>ï¼Œè¿™ä¸ªå±æ€§æ˜¯é»˜è®¤æŒ‡å‘ <code>Object.prototype</code> çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>func.prototype.__proto__ === Object.prototype</code>ã€‚  </p>
<p>æœ‰ä¸€é“å¸¸è§çš„é¢è¯•é¢˜æ˜¯â€œnew æ“ä½œç¬¦åšäº†ä»€ä¹ˆå·¥ä½œâ€ã€‚å®é™…ä¸Š new èƒŒåçš„å·¥ä½œå’Œæ˜¾å¼ç»§æ‰¿çš„æ€è·¯æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å°è¯•ç”¨æ˜¾å¼ç»§æ‰¿çš„æ€è·¯æ¥å†™ä¸€ä¸ª <code>new</code>ã€‚å¤§æ¦‚æ˜¯æŒ‰ä»¥ä¸‹ä¸‰æ­¥èµ°ï¼š1. æ–°å»ºå¯¹è±¡ï¼›2. æ‰‹åŠ¨è®¾ç½®è¯¥æ–°å¯¹è±¡çš„<code>__proto__</code>ä¸º<code>æ„é€ å‡½æ•°.protptype</code>ï¼›3. è¿”å›å¯¹è±¡</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_new</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>(),</span><br><span class="line">	<span class="comment">// è·å¾—æ„é€ å‡½æ•°</span></span><br><span class="line">    Con = [].shift.call(<span class="built_in">arguments</span>);</span><br><span class="line">	<span class="comment">// é“¾æ¥åˆ°åŸå‹</span></span><br><span class="line">    obj.__proto__ = Con.prototype;</span><br><span class="line">	<span class="comment">// ç»‘å®š this å®ç°ç»§æ‰¿ï¼Œobj å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§</span></span><br><span class="line">    Con.apply(obj, <span class="built_in">arguments</span>);</span><br><span class="line">	<span class="comment">// è¿”å›å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ new è¿˜æ˜¯æœ‰åˆ«çš„ç‰¹æ€§çš„ï¼Œä»¥ä¸Šä»£ç åªæ˜¯æœ€åŸºç¡€çš„ã€‚å…³äº new æ“ä½œç¬¦å¯èƒ½ä¹‹åè¿˜ä¼šå†å±•å¼€å†™ä¸€ç¯‡æ–‡ç« ã€‚</p>
<h2 id="2-2-æ–¹æ³•"><a href="#2-2-æ–¹æ³•" class="headerlink" title="2.2 æ–¹æ³•"></a>2.2 æ–¹æ³•</h2><p>ä¸‹é¢è¦è¯´çš„ç»§æ‰¿çš„æ–¹æ³•ï¼Œå…¶å®åŸºæœ¬æ˜¯ä»¥æ˜¾ç¤ºç»§æ‰¿å’Œéšå¼è°ƒç”¨çš„æ€æƒ³ä¸ºåŸºç¡€çš„ã€‚ä»¥ä¸‹æ–¹æ³•æŒ‰ç…§ ã€ŠJavascript é«˜çº§ç¨‹åºè®¾è®¡ã€‹ä¸€ä¹¦åˆ†ç±»ã€‚  </p>
<h3 id="2-2-1-åŸå‹é“¾"><a href="#2-2-1-åŸå‹é“¾" class="headerlink" title="2.2.1 åŸå‹é“¾"></a>2.2.1 åŸå‹é“¾</h3><p>è¿™ä¸ªå®é™…ä¸Šç”¨çš„æ˜¯éšå¼ç»§æ‰¿çš„æ–¹æ³•  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.property = <span class="literal">true</span>;</span><br><span class="line">&#125; </span><br><span class="line">SuperType.prototype.getSuperValue = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.property;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.subproperty = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…³é”®åœ¨è¿™é‡Œï¼ŒSubType.prototype ç»§æ‰¿äº† SuperType.prototypeã€‚</span></span><br><span class="line"><span class="comment">// å¦‚æœæŒ‰ç…§éƒ­å¾·çº²å’Œéƒ­éº’éºŸçš„æ€è·¯ã€‚é‚£ä¹ˆ SubType ç›¸å½“äºéƒ­éº’éºŸè€å©†ï¼ŒSuperType ç›¸å½“äºéƒ­å¾·çº²è€å©†ã€‚</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªè¯­å¥å°±ç›¸å½“äº`éƒ­éº’éºŸè€å©†.è€å…¬ = éƒ­å¾·çº²è€å©†æ–°ç”Ÿä¸€ä¸ªå­©å­`ã€‚æ‰€ä»¥è¿™è¡Œè¯­å¥å®é™…ä¸Šæ˜¯è®©éƒ­éº’éºŸå’Œéƒ­å¾·çº²ä¹‹é—´äº§ç”Ÿçˆ¶å­å…³ç³»</span></span><br><span class="line">SubType.prototype = <span class="keyword">new</span> SuperType();</span><br><span class="line">SubType.prototype.getSubValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.subproperty;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™ä¸ª instance å°±æ˜¯éƒ­éº’éºŸå„¿å­ï¼Œä¹Ÿæ˜¯éƒ­å¾·çº²å­™å­</span></span><br><span class="line"><span class="keyword">var</span> instance = <span class="keyword">new</span> SubType(); </span><br><span class="line">alert(instance.getSuperValue());</span><br><span class="line"><span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/prototype.png" alt="image-20200527234026678"></p>
<h4 id="2-2-1-1-é—®é¢˜"><a href="#2-2-1-1-é—®é¢˜" class="headerlink" title="2.2.1.1 é—®é¢˜"></a>2.2.1.1 é—®é¢˜</h4><blockquote>
<p>åŸå‹é“¾è™½ç„¶å¾ˆå¼ºå¤§ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°ç»§æ‰¿ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å…¶ä¸­ï¼Œæœ€ä¸»è¦çš„é—®é¢˜æ¥è‡ªåŒ…å«å¼• ç”¨ç±»å‹å€¼çš„åŸå‹ã€‚åŒ…å«å¼•ç”¨ç±»å‹å€¼çš„åŸå‹å±æ€§ä¼šè¢«æ‰€æœ‰å®ä¾‹å…±äº«;è€Œè¿™ä¹Ÿæ­£æ˜¯ä¸ºä»€ä¹ˆè¦åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œè€Œä¸æ˜¯åœ¨åŸå‹å¯¹è±¡ä¸­å®šä¹‰å±æ€§çš„åŸå› ã€‚åœ¨é€šè¿‡åŸå‹æ¥å®ç°ç»§æ‰¿æ—¶ï¼ŒåŸ å‹å®é™…ä¸Šä¼šå˜æˆå¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚äºæ˜¯ï¼ŒåŸå…ˆçš„å®ä¾‹å±æ€§ä¹Ÿå°±é¡ºç†æˆç« åœ°å˜æˆäº†ç°åœ¨çš„åŸå‹å±æ€§äº†ã€‚</p>
<p>æ¥è‡ªã€ŠJavascript é«˜çº§ç¨‹åºè®¾è®¡ã€‹</p>
</blockquote>
<h3 id="2-2-2-å€Ÿç”¨æ„é€ å‡½æ•°"><a href="#2-2-2-å€Ÿç”¨æ„é€ å‡½æ•°" class="headerlink" title="2.2.2 å€Ÿç”¨æ„é€ å‡½æ•°"></a>2.2.2 å€Ÿç”¨æ„é€ å‡½æ•°</h3><p>å…³é”®åœ¨â€œå€Ÿç”¨â€ï¼Œæˆ‘ä»¬åœ¨å­æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶æ„é€ å‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//ç»§æ‰¿äº† SuperType</span></span><br><span class="line">  SuperType.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> SubType(); </span><br><span class="line">instance1.colors.push(<span class="string">"black"</span>);</span><br><span class="line">alert(instance1.colors); <span class="comment">//"red,blue,green,black"</span></span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> SubType(); </span><br><span class="line">alert(instance2.colors); <span class="comment">//"red,blue,green"</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå’Œæˆ‘ä»¬ä¹‹å‰è¯´çš„æ˜¾ç¤ºã€éšå¼éƒ½ä¸ä¸€æ ·ï¼Œä»–æ²¡æœ‰æ¶‰åŠåˆ°<code>__proto__</code>çš„å˜åŒ–ã€‚ä½†ç¡®å®å®ç°äº† SubType å®ä¾‹ä¸­æœ‰ SuperType ç›¸å…³çš„å†…å®¹ã€‚é€šè¿‡ä½¿ç”¨ call()æ–¹æ³•(æˆ– apply()æ–¹æ³• ä¹Ÿå¯ä»¥)ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨(æœªæ¥å°†è¦)æ–°åˆ›å»ºçš„ SubType å®ä¾‹çš„ç¯å¢ƒä¸‹è°ƒç”¨äº† SuperType æ„é€ å‡½æ•°ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå°±ä¼šåœ¨æ–° SubType å¯¹è±¡ä¸Šæ‰§è¡Œ SuperType()å‡½æ•°ä¸­å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡åˆå§‹åŒ–ä»£ç ã€‚ç»“æœï¼Œ SubType çš„æ¯ä¸ªå®ä¾‹å°±éƒ½ä¼šå…·æœ‰è‡ªå·±çš„ colors å±æ€§çš„å‰¯æœ¬äº†ã€‚</p>
<h4 id="2-2-2-1-é—®é¢˜"><a href="#2-2-2-1-é—®é¢˜" class="headerlink" title="2.2.2.1 é—®é¢˜"></a>2.2.2.1 é—®é¢˜</h4><blockquote>
<p> å¦‚æœä»…ä»…æ˜¯å€Ÿç”¨æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆä¹Ÿå°†æ— æ³•é¿å…æ„é€ å‡½æ•°æ¨¡å¼å­˜åœ¨çš„é—®é¢˜â€”â€”æ–¹æ³•éƒ½åœ¨æ„é€ å‡½æ•°ä¸­å®š ä¹‰ï¼Œå› æ­¤å‡½æ•°å¤ç”¨å°±æ— ä»è°ˆèµ·äº†ã€‚è€Œä¸”ï¼Œåœ¨è¶…ç±»å‹çš„åŸå‹ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå¯¹å­ç±»å‹è€Œè¨€ä¹Ÿæ˜¯ä¸å¯è§çš„ï¼Œç»“ æœæ‰€æœ‰ç±»å‹éƒ½åªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ã€‚è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ä¹Ÿæ˜¯å¾ˆå°‘å•ç‹¬ä½¿ç”¨çš„</p>
<p>æ¥è‡ªã€ŠJavascript é«˜çº§ç¨‹åºè®¾è®¡ã€‹</p>
</blockquote>
<h3 id="2-2-3-ç»„åˆç»§æ‰¿"><a href="#2-2-3-ç»„åˆç»§æ‰¿" class="headerlink" title="2.2.3 ç»„åˆç»§æ‰¿"></a>2.2.3 ç»„åˆç»§æ‰¿</h3><p>ç»“åˆå‰ä¸¤ç§ç»§æ‰¿æ–¹æ³•ã€‚ç”¨åŸå‹é“¾å»ç»§æ‰¿åŸå‹ä¸Šä¸€äº›å…±äº«çš„å±æ€§/æ–¹æ³•ï¼Œç”¨æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–å®ä¾‹å±æ€§ã€‚</p>
<h3 id="2-2-4-åŸå‹å¼ç»§æ‰¿"><a href="#2-2-4-åŸå‹å¼ç»§æ‰¿" class="headerlink" title="2.2.4 åŸå‹å¼ç»§æ‰¿"></a>2.2.4 åŸå‹å¼ç»§æ‰¿</h3><p>è¿™ä¸ªå…³é”®å°±æ˜¯åŸºäºå·²æœ‰çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥ç”¨æ˜¾å¼ä¹Ÿå¯ä»¥ç”¨éšå¼ã€‚</p>
<p>å…ˆçœ‹çœ‹æ˜¾ç¤ºç»§æ‰¿ï¼š  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span> (<span class="params">prototype</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>(),</span><br><span class="line">	<span class="comment">// é“¾æ¥åˆ°åŸå‹</span></span><br><span class="line">    obj.__proto__ = prototype;</span><br><span class="line">	<span class="comment">// è¿”å›å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯å’Œä¹‹å‰å†™çš„â€œnewâ€ç‰¹åˆ«åƒï¼Ÿï¼Ÿæ”¹å·´æ”¹å·´å°±å˜æˆéšå¼ç»§æ‰¿äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span> (<span class="params">prototype</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  F.prototype = prototype</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ECMAScript 5 æ–°å¢äº† Object.create() æ–¹æ³•ç”¨äºåŸå‹å¼ç»§æ‰¿ã€‚åœ¨æ²¡æœ‰å¿…è¦å…´å¸ˆåŠ¨ä¼—åœ°åˆ›å»ºæ„é€ å‡½æ•°ï¼Œè€Œåªæƒ³è®©ä¸€ä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡ä¿æŒç±»ä¼¼çš„æƒ…å†µä¸‹ï¼ŒåŸå‹å¼ç»§æ‰¿æ˜¯å®Œå…¨å¯ä»¥èƒœä»»çš„</p>
<h3 id="2-2-5-å¯„ç”Ÿå¼ç»§æ‰¿"><a href="#2-2-5-å¯„ç”Ÿå¼ç»§æ‰¿" class="headerlink" title="2.2.5 å¯„ç”Ÿå¼ç»§æ‰¿"></a>2.2.5 å¯„ç”Ÿå¼ç»§æ‰¿</h3><p>è¿™ä¸ªå¯„ç”Ÿå¼ç»§æ‰¿ï¼Œæˆ‘ç†è§£å°±æ˜¯åŸå‹å¼ç»§æ‰¿ä¸Šå†åŠ ç‚¹ä¸œè¥¿ã€‚æˆ‘æ¨èå’Œæ¥ä¸‹æ¥çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿è”ç³»èµ·æ¥çœ‹ã€‚</p>
<h3 id="2-2-6-å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"><a href="#2-2-6-å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿" class="headerlink" title="2.2.6 å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿"></a>2.2.6 å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿</h3><p>é¡¾åæ€ä¹‰ï¼Œå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿=å¯„ç”Ÿå¼ç»§æ‰¿+ç»„åˆç»§æ‰¿ã€‚ä¸ºä»€ä¹ˆè¦æœ‰å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿å‘¢ï¼Ÿæ˜æ˜å…¶ä»–æ–¹æ³•å·²ç»å¾ˆé¦™äº†ã€‚å› ä¸ºå®ƒ<strong>è§£å†³äº†ç»„åˆç»§æ‰¿ä¸­è°ƒç”¨2æ¬¡æ„é€ å‡½æ•°çš„é—®é¢˜</strong>ã€‚</p>
<p>å½“æˆ‘ä»¬åœ¨è®¨è®º 2 ä¸ªç±»ï¼ˆå½“ç„¶ï¼ŒJS ä¸­å°±æ˜¯ä¸ªå‡½æ•°ï¼‰ä¹‹é—´çš„ç»§æ‰¿æ—¶ï¼Œå›é¡¾æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ 5 ç§æ–¹æ³•ã€‚é¦–å…ˆä¸é€‚åˆçš„æ˜¯åŸå‹å¼ç»§æ‰¿ï¼Œå› ä¸ºå®ƒé€‚ç”¨äº 2 ä¸ªå¯¹è±¡ä¹‹é—´ã€‚å…¶æ¬¡åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°å„è‡ªéƒ½æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œç»„åˆç»§æ‰¿ç»“åˆäº†è¿™ä¸¤è€…ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸ªç¼ºç‚¹å°±æ˜¯ä¼šè°ƒç”¨ 2 æ¬¡çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚é‚£ä¹ˆâ€œå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿â€å°±æ˜¯é€šè¿‡å¯„ç”Ÿå¼ç»§æ‰¿çš„æ–¹æ³•æ¥è§£å†³äº†ç»„åˆç»§æ‰¿çš„è¿™ä¸ªç¼ºç‚¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯„ç”Ÿå¼ç»§æ‰¿</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">subType, superType</span>)</span>&#123; </span><br><span class="line">  <span class="comment">// åŸå‹å¼ç»§æ‰¿</span></span><br><span class="line">  <span class="keyword">var</span> prototype = <span class="built_in">Object</span>.create(superType.prototype); </span><br><span class="line">  <span class="comment">// å†åŠ ç‚¹ä¸œè¥¿</span></span><br><span class="line">  prototype.constructor = subType;</span><br><span class="line">  <span class="comment">// åŸå‹é“¾</span></span><br><span class="line">  subType.prototype = prototype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„åˆç»§æ‰¿=åŸå‹é“¾+å€Ÿç”¨æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SuperType</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">  <span class="keyword">this</span>.colors = [<span class="string">"red"</span>, <span class="string">"blue"</span>, <span class="string">"green"</span>];</span><br><span class="line">&#125;</span><br><span class="line">SuperType.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">  alert(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubType</span>(<span class="params">name, age</span>)</span>&#123; </span><br><span class="line">  <span class="comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°</span></span><br><span class="line">  SuperType.call(<span class="keyword">this</span>, name);</span><br><span class="line">  <span class="keyword">this</span>.age = age; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">inheritPrototype(SubType, SuperType);</span><br></pre></td></tr></table></figure>




<h1 id="3-Object-prototype"><a href="#3-Object-prototype" class="headerlink" title="3. Object.prototype"></a>3. <code>Object.prototype</code></h1><p>è¿™æ˜¯ä¸€ä¸ªååˆ†ç‰¹æ®Šçš„å¯¹è±¡</p>
<ol>
<li>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡æ¯ä¸ªå‡½æ•°éƒ½é»˜è®¤æœ‰åŸå‹çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯ <code>Object</code> å‡½æ•°çš„åŸå‹</li>
<li>è¿™ä¸ªæ˜¯ JS å¼•æ“åœ¨æœ€å¼€å§‹å®šä¹‰çš„ä¸€ä¸ªå¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³åƒæˆå¥³å¨²ï¼Œé‚£ä¹ˆè‡ªç„¶   <ol>
<li>å¥³å¨²æ˜¯æ²¡æœ‰åŸå‹çš„ï¼Œå³ <code>Object.prototype.__proto__ === null</code></li>
<li>æ‰€æœ‰æ²¡çˆ¸æ²¡å¦ˆçš„å­©å­éƒ½å½“ä½œå¥³å¨²çš„å­©å­ã€‚ <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ™®æ™®é€šé€šä¸€å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> a = &#123; <span class="attr">name</span>: <span class="string">'æ²¡çˆ¸æ²¡å¦ˆ'</span> &#125;</span><br><span class="line">a.__proto__ === <span class="built_in">Object</span>.prototype <span class="comment">// true</span></span><br></pre></td></tr></table></figure>




</li>
</ol>
</li>
</ol>
<h1 id="4-åŸå‹é“¾"><a href="#4-åŸå‹é“¾" class="headerlink" title="4. åŸå‹é“¾"></a>4. åŸå‹é“¾</h1><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œæ¯ä¸ªå¯¹è±¡åœ¨ã€ç»™å…¶å®ƒå¯¹è±¡æä¾›å…±äº«å±æ€§ã€‘æ—¶å°±æ˜¯åŸå‹çš„ï¼Œä¸”ä¸¤è€…ä¹‹å‰æ˜¯é€šè¿‡ <code>__proto__</code> æ¥éšå¼åœ°å…³è”èµ·æ¥çš„ã€‚é‚£ä¹ˆå‡è®¾æœ‰ <code>A.__proto__ = B</code>ï¼ŒB è™½ç„¶æ˜¯ A çš„åŸå‹ï¼Œä½†å®ƒè‡ªèº«ä¹Ÿå¯ä»¥æœ‰åŸå‹ï¼Œä¹Ÿå°±æ˜¯ <code>B.__proto__ = C</code>ã€‚å¦‚ä¸‹å›¾</p>
<pre class="mermaid">graph LR
A[A] --> |__proto__|B[B]
B --> |__proto__|C[C]
C --> |__proto__|D[...]
D --> |__proto__|E[Object.prototype]
E --> |__proto__|F[null]</pre>
<p>è¿™æ¡é“¾ä¸€ç›´ä¸‹å»çš„è¯ï¼Œæœ€ç»ˆä¼šæŒ‡å‘ <code>Object.prototype</code></p>
<h2 id="4-1-å±æ€§æŸ¥æ‰¾"><a href="#4-1-å±æ€§æŸ¥æ‰¾" class="headerlink" title="4.1 å±æ€§æŸ¥æ‰¾"></a>4.1 å±æ€§æŸ¥æ‰¾</h2><p>é—®ï¼šå‡è®¾â€œæŠ¥èœåâ€æ˜¯è€éƒ­å®¶çš„ç‹¬é—¨ç»æŠ€ï¼Œç°åœ¨éƒ­éº’éºŸæƒ³å­¦ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ<br>ç­”ï¼š1. éƒ­éº’éºŸå·²ç»ä¼šäº†ï¼Œé‚£å°±è‡ªå·±å†å¤ä¹ ä¸‹ï¼›2.éƒ­éº’éºŸä¸ä¼šï¼Œé‚£é—®ä»–çˆ¸ï¼›3. ä»–çˆ¸ä¹Ÿä¸ä¼šï¼Œé‚£é—®ä»–çˆ·çˆ·</p>
<p>åŒç†ã€‚å½“æˆ‘ä»¬è®¿é—®å¯¹è±¡çš„å±æ€§æ—¶ï¼Œä¹Ÿä¼šæ²¿ç€åŸå‹é“¾ä¸€ç›´æŸ¥æ‰¾</p>
<h1 id="5-æ€»ç»“"><a href="#5-æ€»ç»“" class="headerlink" title="5. æ€»ç»“"></a>5. æ€»ç»“</h1><p>å¦‚æœä½ çœ‹å®Œäº†æ–‡ç« è¿˜æ˜¯ä¸€å›¢ä¹±éº»ï¼Œé‚£ä¹ˆæˆ‘è‡ªå·±æ€»ç»“äº†ä¸€äº›è¦ç‚¹å¸®åŠ©è®°å¿†å’Œç†è§£</p>
<ol>
<li>æ‰€æœ‰å¯¹è±¡éƒ½æœ‰ <code>__proto__</code></li>
<li>æ‰€æœ‰å‡½æ•°éƒ½é»˜è®¤æœ‰ <code>prototype</code></li>
<li>å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æœ‰ <code>__proto__</code></li>
<li>æ‰€æœ‰å‡½æ•°éƒ½ç»§æ‰¿è‡ª <code>Function</code></li>
</ol>
<!-- TODO -->

<h1 id="6-å‚è€ƒæ–‡ç« "><a href="#6-å‚è€ƒæ–‡ç« " class="headerlink" title="6. å‚è€ƒæ–‡ç« "></a>6. å‚è€ƒæ–‡ç« </h1><ul>
<li><a href="https://mp.weixin.qq.com/s/1UDILezroK5wrcK-Z5bHOg">æ·±å…¥ç†è§£ JavaScript åŸå‹</a></li>
</ul>
]]></content>
      <tags>
        <tag>js</tag>
        <tag>åŸå‹</tag>
      </tags>
  </entry>
</search>
