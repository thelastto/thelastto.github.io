<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>apply/call/bind ä¸€ç½‘æ‰“å°½</title>
    <url>/2020/04/28/apply-call-bind/</url>
    <content><![CDATA[<p>é¦–å…ˆï¼Œè¿™ä¸‰ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ”¹å˜ this æŒ‡å‘çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒä»¬çš„å¼‚åŒã€‚</p>
<a id="more"></a>

<h1 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h1><ul>
<li>è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨å¦ä¸€ä¸ªå¯¹è±¡æ›¿æ¢å½“å‰å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š<code>B.apply(A, arguments)</code>; å³ A å¯¹è±¡åº”ç”¨ B å¯¹è±¡çš„æ–¹æ³•ã€‚</li>
<li>è¦æ³¨æ„çš„æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°å¤„äºéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåˆ™æŒ‡å®šä¸º null æˆ– undefined æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºæŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œè€Œå…¶ä»–åŸå§‹å€¼åˆ™ä¼šè¢«ç›¸åº”çš„åŒ…è£…å¯¹è±¡ï¼ˆwrapper objectï¼‰æ‰€æ›¿ä»£ã€‚</li>
</ul>
<h2 id="å¦‚ä½•å®ç°ä¸€ä¸ªapply"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªapply" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªapply"></a>å¦‚ä½•å®ç°ä¸€ä¸ªapply</h2><p>å›é¡¾ä¸€ä¸‹ apply çš„æ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´æŒ‰ä»¥ä¸‹æ€è·¯èµ°</p>
<ol>
<li>å®ç°ç¬¬ä¸€ä¸ªå‚æ•°çš„åŠŸèƒ½ï¼Œæ”¹å˜ this æŒ‡å‘</li>
<li>å®ç°ç¬¬äºŒä¸ªå‚æ•°çš„åŠŸèƒ½ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä½œä¸ºè°ƒç”¨å‡½æ•°çš„å‚æ•°</li>
<li>è¿”å›å€¼ï¼šä½¿ç”¨è°ƒç”¨è€…æä¾›çš„ this å€¼å’Œå‚æ•°è°ƒç”¨è¯¥å‡½æ•°çš„è¿”å›å€¼ã€‚è‹¥è¯¥æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™è¿”å› undefinedã€‚</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰ä»¥ä¸Šæ€è·¯æ¥å®ç°ä¸€ä¸‹ã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥ï¼Œç»‘å®š-this"><a href="#ç¬¬ä¸€æ­¥ï¼Œç»‘å®š-this" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œç»‘å®š this"></a>ç¬¬ä¸€æ­¥ï¼Œç»‘å®š this</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">f.apply(o);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ä¸‹é¢ä»£ç çš„åŠŸèƒ½ç±»ä¼¼ï¼ˆå‡è®¾å¯¹è±¡oä¸­é¢„å…ˆä¸å­˜åœ¨åä¸ºmçš„å±æ€§ï¼‰ã€‚</span></span><br><span class="line">o.m=f; <span class="comment">//å°†få­˜å‚¨ä¸ºoçš„ä¸´æ—¶æ–¹æ³•</span></span><br><span class="line">o.m(); <span class="comment">//è°ƒç”¨å®ƒï¼Œä¸ä¼ å…¥å‚æ•°</span></span><br><span class="line"><span class="keyword">delete</span> o.m;<span class="comment">//å°†ä¸´æ—¶æ–¹æ³•åˆ é™¤</span></span><br></pre></td></tr></table></figure>
<p>(ä»¥ä¸Šä»£ç æ‘˜å½•è‡ªçŠ€ç‰›ä¹¦)<br>ä¾æ ·ç”»è‘«èŠ¦ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line">    context.__fn()</span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°"><a href="#ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°"></a>ç¬¬äºŒæ­¥ï¼Œç»™å‡½æ•°ä¼ é€’å‚æ•°</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³åŠæ³•å®ç°ä¸€ä¸‹ apply çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚å…¶å®æˆ‘æœ€å¿«æƒ³åˆ°çš„æ˜¯ ES6 çš„æ–¹æ³•ã€‚ç”¨<code>...</code> ç›´æ¥å±•å¼€å°±è¡Œäº†ã€‚ä¸è¿‡ apply æ‰ ES3ğŸ˜‚ï¼Œè¿˜æ˜¯å†æƒ³æƒ³è€çš„åŠæ³•å§ã€‚</p>
<p>éš¾ç‚¹æ˜¯è¿™ä¸ªæ•°ç»„çš„é•¿åº¦æ˜¯ä¸ç¡®å®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ²¡åŠæ³•å¾ˆå‡†ç¡®åœ°ç»™å‡½æ•°ä¸€ä¸ªä¸ªä¼ å‚ã€‚æˆ‘ä»¬æ‰€èƒ½åšçš„å¤„ç†ä¹Ÿå°±æ˜¯æŠŠ<code>arguments</code>è½¬æˆå­—ç¬¦ä¸²å½¢å¼<code>&#39;arguments[1], arguments[2], ...&#39;</code>ã€‚é‚£ä¹ˆå¦‚ä½•è®©å­—ç¬¦ä¸²èƒ½è¿è¡Œèµ·æ¥å‘¢ï¼Ÿï¼Ÿç­”æ¡ˆå°±æ˜¯ <code>eval</code>ï¼</p>
<p>ç¨ç¨æ€»ç»“ä¸€ä¸‹, ç›®å‰æƒ³åˆ°çš„ 2 ç§æ–¹æ³•</p>
<blockquote>
<ol>
<li>es6ã€‚<code>context.__fn(...arguments)</code></li>
<li>æŠŠ arguments è½¬æ¢æˆstringï¼Œæ”¾åˆ° eval é‡Œé¢è¿è¡Œ <code>eval(&#39;context.__fn(&#39;+ &#39;arguments[1], arguments[2]&#39; +&#39;)&#39;)</code></li>
</ol>
</blockquote>
<p>ä»¥ä¸‹æ˜¯ç¬¬äºŒç§æ€è·¯çš„ä»£ç ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, others</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="comment">// args: 'others[0], others[1], others[2], ...'</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = others.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'others['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼"><a href="#ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼"></a>ç¬¬ä¸‰æ­¥ï¼Œè¿”å›å€¼</h3><p>è¿”å›å‡½æ•°è°ƒç”¨åçš„ç»“æœå°±è¡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, others</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="comment">// args: 'others[0], others[1], others[2], ...'</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = others.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'others['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„-this"><a href="#æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„-this" class="headerlink" title="æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„ this"></a>æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹çš„ this</h3><p>æˆ‘ä»¬ä¹‹å‰æœ‰æåˆ°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°å¤„äºéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œåˆ™æŒ‡å®šä¸º null æˆ– undefined æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºæŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œè€Œå…¶ä»–åŸå§‹å€¼åˆ™ä¼šè¢«ç›¸åº”çš„åŒ…è£…å¯¹è±¡ï¼ˆwrapper objectï¼‰æ‰€æ›¿ä»£</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context, others</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> argsArray === <span class="string">'undefined'</span> || argsArray === <span class="literal">null</span>) &#123;</span><br><span class="line">        context = <span class="built_in">window</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// context æ˜¯ä¸€ä¸ª object</span></span><br><span class="line">    context = <span class="keyword">new</span> <span class="built_in">Object</span>(context)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = others.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'others['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿-fn-ä¸å­˜åœ¨"><a href="#å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿-fn-ä¸å­˜åœ¨" class="headerlink" title="å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿ __fn ä¸å­˜åœ¨"></a>å†è¿›ä¸€æ­¥ï¼Œç¡®ä¿ __fn ä¸å­˜åœ¨</h3><p>æˆ‘ä»¬ä¹‹å‰çš„ä»£ç éƒ½æ˜¯å»ºç«‹åœ¨ <code>__fn</code> ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆä¸‡ä¸€å­˜åœ¨å‘¢ï¼Ÿå› æ­¤æˆ‘ä»¬æ¥ä¸‹æ¥å°±è¦æ‰¾ä¸€ä¸ª <code>context</code> ä¸­æ²¡æœ‰å­˜åœ¨è¿‡çš„å±æ€§ã€‚<br>ğŸ¤”æˆ‘ä»¬å¾ˆå¿«å¯ä»¥æƒ³åˆ° ES6 çš„ symbolã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åƒè¿™æ ·</span></span><br><span class="line"><span class="keyword">var</span> __fn = <span class="keyword">new</span> <span class="built_in">Symbol</span>()</span><br><span class="line">context[__fn] = <span class="keyword">this</span></span><br></pre></td></tr></table></figure>
<p>ğŸ¤”å¦‚æœä¸ç”¨ ES6ï¼Œé‚£ä¹ˆå¦ä¸€ç§æ–¹æ³•ï¼Œæ˜¯æ ¹æ® <a href="https://juejin.im/post/5bf6c79bf265da6142738b29#heading-4">è¿™ç¯‡æ–‡ç« </a>ä¸­æåˆ°çš„ï¼Œè‡ªå·±ç”¨ Math.random() æ¨¡æ‹Ÿå®ç°ç‹¬ä¸€æ— äºŒçš„ keyã€‚é¢è¯•æ—¶å¯ä»¥ç›´æ¥ç”¨ç”Ÿæˆæ—¶é—´æˆ³å³å¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆ UUID é€šç”¨å”¯ä¸€è¯†åˆ«ç </span></span><br><span class="line"><span class="comment">// å¤§æ¦‚ç”Ÿæˆ è¿™æ ·ä¸€ä¸² '18efca2d-6e25-42bf-a636-30b8f9f2de09'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateUUID</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i, random;</span><br><span class="line">    <span class="keyword">var</span> uuid = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        random = <span class="built_in">Math</span>.random() * <span class="number">16</span> | <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (i === <span class="number">8</span> || i === <span class="number">12</span> || i === <span class="number">16</span> || i === <span class="number">20</span>) &#123;</span><br><span class="line">            uuid += <span class="string">'-'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        uuid += (i === <span class="number">12</span> ? <span class="number">4</span> : (i === <span class="number">16</span> ? (random &amp; <span class="number">3</span> | <span class="number">8</span>) : random))</span><br><span class="line">            .toString(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> uuid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç®€å•å®ç°</span></span><br><span class="line"><span class="comment">// '__' + new Date().getTime();</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿™ä¸ªkeyä¸‡ä¸€è¿™å¯¹è±¡ä¸­è¿˜æ˜¯æœ‰ï¼Œä¸ºäº†ä¿é™©èµ·è§ï¼Œå¯ä»¥åšä¸€æ¬¡ç¼“å­˜æ“ä½œ(å°±æ˜¯å…ˆæŠŠä¹‹å‰çš„å€¼ä¿å­˜èµ·æ¥)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åƒè¿™æ ·</span></span><br><span class="line"><span class="keyword">var</span> originalvalue = context.__fn</span><br><span class="line"><span class="keyword">var</span> hasOriginalValue = context.hasOwnProperty(<span class="string">'__fn'</span>)</span><br><span class="line">context.__fn = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(hasOriginalValue)&#123;</span><br><span class="line">    context.__fn = originalvalue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="call"><a href="#call" class="headerlink" title="call"></a>call</h1><ul>
<li><p>å’Œ apply çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ <code>call()</code> æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªå‚æ•°åˆ—è¡¨ï¼Œè€Œ <code>apply()</code> æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå‚æ•°çš„æ•°ç»„ã€‚</p>
</li>
<li><p>ä¾‹å¦‚ <code>func.apply(obj, [1,2])</code> ç›¸å½“äº <code>func.call(obj, 1, 2)</code></p>
</li>
</ul>
<h2 id="å®ç°ä¸€ä¸ª-call"><a href="#å®ç°ä¸€ä¸ª-call" class="headerlink" title="å®ç°ä¸€ä¸ª call"></a>å®ç°ä¸€ä¸ª call</h2><p>æ€è·¯å’Œ apply ä¸€æ ·ã€‚å”¯ä¸€åŒºåˆ«å°±åœ¨äºå‚æ•°å½¢å¼ã€‚æˆ‘ä»¬æŒ‰ç…§ call çš„è¦æ±‚æ¥å¤„ç†å‚æ•°å°±å¯ä»¥äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.apply = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// context å°±æ˜¯éœ€è¦ç»‘å®šçš„å¯¹è±¡ï¼Œç›¸å½“äºä¸Šé¢çš„ o</span></span><br><span class="line">    <span class="comment">// this å°±æ˜¯è°ƒç”¨äº† apply çš„å‡½æ•°ï¼Œç›¸å½“äº f</span></span><br><span class="line">    context.__fn = <span class="keyword">this</span> <span class="comment">// å‡è®¾åŸå…ˆæ²¡æœ‰__fn</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> args = [];</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬ä» arguments[1] å¼€å§‹æ‹¼å°±å¥½äº†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</span><br><span class="line">        args.push(<span class="string">'arguments['</span> + i + <span class="string">']'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">eval</span>(<span class="string">'context.__fn('</span> + args.toString() + <span class="string">')'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> context.__fn</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h1><p>æˆ‘ä»¬å¸¸å°† bind å’Œä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•åŒºåˆ†å¼€ï¼Œæ˜¯å› ä¸º bind æ˜¯ ECMAScript 5 ä¸­çš„æ–¹æ³•ï¼Œä¸”é™¤äº†å°†å‡½æ•°ç»‘å®šè‡³ä¸€ä¸ªå¯¹è±¡å¤–è¿˜å¤šäº†ä¸€äº›ç‰¹ç‚¹ã€‚</p>
<ul>
<li><p><strong>bind() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°</strong>ï¼Œåœ¨ bind() è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„ this è¢«æŒ‡å®šä¸º bind() çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„åˆå§‹å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">func.apply(obj, [<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="comment">// ç›¸å½“äº</span></span><br><span class="line">func.call(obj, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// ç›¸å½“äº</span></span><br><span class="line"><span class="keyword">var</span> boundFun = func.bind(obj, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">boundFun()</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥è¿™æ ·</span></span><br><span class="line"><span class="keyword">var</span> boundFun = func.bind(obj, <span class="number">1</span>)</span><br><span class="line">boundFun(<span class="number">2</span>)</span><br></pre></td></tr></table></figure></li>
<li><p><strong>ç»‘å®šå‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ new è¿ç®—ç¬¦æ„é€ </strong>ï¼Œå®ƒä¼šè¡¨ç°ä¸ºç›®æ ‡å‡½æ•°å·²ç»è¢«æ„å»ºå®Œæ¯•äº†ä¼¼çš„ã€‚æä¾›çš„ this å€¼ä¼šè¢«å¿½ç•¥ï¼Œä½†å‰ç½®å‚æ•°ä»ä¼šæä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚</p>
</li>
</ul>
<h2 id="å®ç°ä¸€ä¸ª-bind"><a href="#å®ç°ä¸€ä¸ª-bind" class="headerlink" title="å®ç°ä¸€ä¸ª bind"></a>å®ç°ä¸€ä¸ª bind</h2><p>æˆ‘ä»¬è¿˜æ˜¯å…ˆå¤§è‡´æ€è€ƒä¸€ä¸‹è¯¥æ€ä¹ˆåšï¼š</p>
<ol>
<li>å®ç°ç¬¬ä¸€ä¸ªå‚æ•°çš„åŠŸèƒ½ï¼Œæ”¹å˜ this æŒ‡å‘ã€‚è¿™ä¸ªå’Œ apply/call æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚</li>
<li>å®ç°å…¶å®ƒå‚æ•°ã€‚å…¶å®ƒå‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„åˆå§‹å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚è¿™ä¸ªå’Œ call æœ‰äº›ç›¸ä¼¼ã€‚</li>
<li>ä½¿ç”¨ new æ“ä½œç¬¦æ—¶ï¼Œåº”è¯¥å¿½ç•¥ç¬¬ä¸€ä¸ªå‚æ•°</li>
</ol>
<p>åç»­çš„æ­¥éª¤æˆ‘ä¼šç”¨ apply/call æ¥å®ç°bindã€‚å¦‚æœä¸æƒ³ç›´æ¥ç”¨ apply/callï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§ä¸Šæ–‡å…ˆå®ç°ä¸€ä¸ª apply/callã€‚</p>
<h3 id="ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº†-this-çš„æ–°å‡½æ•°"><a href="#ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº†-this-çš„æ–°å‡½æ•°" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº† this çš„æ–°å‡½æ•°"></a>ç¬¬ä¸€æ­¥ï¼Œè¿”å›ä¸€ä¸ªç»‘å®šäº† this çš„æ–°å‡½æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> self.apply(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°"><a href="#ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°"></a>ç¬¬äºŒæ­¥ï¼Œç»™æ–°å‡½æ•°è®¾å®šåˆå§‹å‚æ•°</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– bind å‡½æ•°ä»ç¬¬äºŒä¸ªå‚æ•°åˆ°æœ€åä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">var</span> initialArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªç»‘å®šå¥½ this çš„æ–°å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ˜¯è°ƒç”¨æ–°å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">var</span> boundArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">        <span class="comment">// æœ€ç»ˆçš„å‚æ•°åº”è¯¥æ˜¯åˆå§‹å‚æ•°+æ–°å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">return</span> self.apply(context, args.concat(bindArgs));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„-this"><a href="#ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„-this" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„ this"></a>ç¬¬ä¸‰æ­¥ï¼Œä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¿½ç•¥è¦ç»‘å®šçš„ this</h3><p>è¿™é‡Œçš„éš¾ç‚¹æ˜¯æ€ä¹ˆçŸ¥é“æ˜¯ç”± new è°ƒç”¨çš„ã€‚<br>å…ˆè¯´ä¸€ä¸‹ç­”æ¡ˆå§</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡å¦‚æœ‰ä»¥ä¸‹å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¯¹äº <code>var gioia = new Person()</code> æ¥è¯´<br>ä½¿ç”¨ new æ—¶ï¼Œthis ä¼šæŒ‡å‘ gioiaï¼Œå¹¶ä¸” gioia æ˜¯ Person çš„å®ä¾‹ã€‚<br>å› æ­¤ï¼Œå¦‚æœ <code>this instance Person</code>ï¼Œå°±è¯´æ˜æ˜¯ new è°ƒç”¨çš„</p>
</blockquote>
<p>new è¿™ä¸€éƒ¨åˆ†è¿™é‡Œå…ˆä¸å±•å¼€è®²ï¼Œæœ‰å…´è¶£çš„å¯ä»¥çœ‹ä¸€ä¸‹ <a href="https://github.com/mqyqingfeng/Blog/issues/13">JavaScriptæ·±å…¥ä¹‹newçš„æ¨¡æ‹Ÿå®ç°</a><br>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å†™ä»£ç äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.bind = <span class="function"><span class="keyword">function</span> (<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å– bind å‡½æ•°ä»ç¬¬äºŒä¸ªå‚æ•°åˆ°æœ€åä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="keyword">var</span> initialArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªç»‘å®šå¥½ this çš„æ–°å‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Bound</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ˜¯è°ƒç”¨æ–°å‡½æ•°æ—¶ä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">var</span> boundArgs = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">        <span class="comment">// æœ€ç»ˆçš„å‚æ•°åº”è¯¥æ˜¯åˆå§‹å‚æ•°+æ–°å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">return</span> self.apply(<span class="keyword">this</span> instance Bound ? <span class="keyword">this</span> : context, args.concat(bindArgs));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Bound.prototype = <span class="keyword">this</span>.prototype</span><br><span class="line">    <span class="keyword">return</span> Bound</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><ul>
<li><a href="https://juejin.im/post/5bf6c79bf265da6142738b29">é¢è¯•å®˜é—®ï¼šèƒ½å¦æ¨¡æ‹Ÿå®ç°JSçš„callå’Œapplyæ–¹æ³•</a></li>
<li><a href="https://juejin.im/post/5907eb99570c3500582ca23c">JavaScriptæ·±å…¥ä¹‹callå’Œapplyçš„æ¨¡æ‹Ÿå®ç°</a></li>
<li><a href="https://github.com/mqyqingfeng/Blog/issues/12">JavaScriptæ·±å…¥ä¹‹bindçš„æ¨¡æ‹Ÿå®ç°</a></li>
</ul>
]]></content>
      <tags>
        <tag>this</tag>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>å†™ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·</title>
    <url>/2020/04/30/miniwebpack/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸çŸ¥é“æœ‰æ²¡æœ‰äººå’Œæˆ‘ä¸€æ ·ï¼Œä¸ç®¡çœ‹äº†å‡ éæ–‡æ¡£ï¼Œè¿˜æ˜¯ä¸ä¼šè‡ªå·±å†™ webpackï¼Œåªèƒ½åœ¨åˆ«äººå†™çš„é…ç½®ä¸Šä¿®ä¿®è¡¥è¡¥ï¼Œæ›´åˆ«æä»€ä¹ˆä¼˜åŒ–äº†ã€‚<br>äºæ˜¯æˆ‘ç—›å®šæ€ç—›ï¼Œå†³å®šä»æºå¤´ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ä¸ºäº†æ›´å¥½åœ°åº”ç”¨ webpackï¼Œæˆ‘ä»¬åº”è¯¥äº†è§£å®ƒèƒŒåçš„å·¥ä½œåŸç†ã€‚<br>å› æ­¤ï¼Œæˆ‘é˜…è¯»äº† <a href="https://github.com/ronami/minipack/blob/master/src/minipack.js">miniwebpack</a> è¿™ä¸ªä»“åº“ã€‚è¿™ä¸ªä»“åº“å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„æ‰“åŒ…å·¥å…·ã€‚æ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§æˆ‘çš„ç†è§£æ¥è§£é‡Šä¸€ä¸‹æ€ä¹ˆå®ç°ä¸€ä¸ªç®€å•çš„æ‰“åŒ…å·¥å…·</p>
<a id="more"></a>

<h1 id="ä¸»è¦æ€è·¯"><a href="#ä¸»è¦æ€è·¯" class="headerlink" title="ä¸»è¦æ€è·¯"></a>ä¸»è¦æ€è·¯</h1><ol>
<li>ä»£ç å¤„ç†ã€‚æˆ‘ä»¬å¹³å¸¸å†™ä»£ç çš„æ—¶å€™ï¼Œç”¨çš„å¯èƒ½æ˜¯ES6ã€ES7ç­‰é«˜ç‰ˆæœ¬çš„è¯­æ³•ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬è½¬æ¢æˆæµè§ˆå™¨èƒ½è¿è¡Œçš„è¯­æ³•</li>
<li>æ‰“åŒ…ã€‚éœ€è¦æ ¹æ®ä¸€ä¸ª entry æ¥è¾“å‡ºä¸€ä¸ª outputï¼Œæˆ‘ä»¬é€šè¿‡ç»´æŠ¤ä¸€ä¸ªä¾èµ–å…³ç³»å›¾æ¥è§£å†³è¿™ä¸ªé—®é¢˜</li>
</ol>
<pre class="mermaid">graph LR
A[entry] --> |è§£æä»£ç | B[AST]
B --> |ç”Ÿæˆ| C[æµè§ˆå™¨å¯ç”¨ä»£ç ]
B --> |æ£€æŸ¥importå£°æ˜| D[ä¾èµ–]
C --> E[æ¨¡å—ä¿¡æ¯]
D --> E
E --> F[ä¾èµ–å…³ç³»å›¾]
F --> |ç”Ÿæˆæœ€ç»ˆä»£ç | G[output]</pre>

<h1 id="ä»£ç å¤„ç†"><a href="#ä»£ç å¤„ç†" class="headerlink" title="ä»£ç å¤„ç†"></a>ä»£ç å¤„ç†</h1><ol>
<li>è§£æï¼ˆparseï¼‰ã€‚å°†æºä»£ç å˜æˆASTã€‚</li>
<li>è½¬æ¢ï¼ˆtransformï¼‰ã€‚æ“ä½œASTï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¯ä»¥æ“ä½œçš„éƒ¨åˆ†ï¼Œå»æ”¹å˜ä»£ç ã€‚</li>
<li>ç”Ÿæˆï¼ˆgenerateï¼‰ã€‚å°†æ›´æ”¹åçš„ASTï¼Œå†å˜å›ä»£ç ã€‚  <blockquote>
<p>å‚è€ƒï¼š<a href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/plugin-handbook.md#toc-stages-of-babel">Babelç”¨æˆ·æ‰‹å†Œ</a></p>
</blockquote>
</li>
</ol>
<p>ä¸‹é¢æˆ‘å°†ä»‹ç»ä¸€äº›è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°çš„å·¥å…·ã€‚</p>
<h2 id="è§£æå™¨-babylon"><a href="#è§£æå™¨-babylon" class="headerlink" title="è§£æå™¨ babylon"></a>è§£æå™¨ babylon</h2><p>ç”¨æ¥å°†æºä»£ç è½¬æ¢ä¸º ASTã€‚<br>ï¼ˆä¸äº†è§£ AST çš„ï¼Œå¯ä»¥å…ˆçœ‹çœ‹<a href="https://astexplorer.net/">åœ¨çº¿ASTè½¬æ¢å™¨</a>ã€‚ï¼‰</p>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save babylon</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> babylon <span class="keyword">from</span> <span class="string">"babylon"</span>;</span><br><span class="line"></span><br><span class="line">babylon.parse(code, [options])</span><br></pre></td></tr></table></figure>

<h2 id="è½¬æ¢å™¨-babel-traverse"><a href="#è½¬æ¢å™¨-babel-traverse" class="headerlink" title="è½¬æ¢å™¨ babel-traverse"></a>è½¬æ¢å™¨ babel-traverse</h2><p>ç”¨æ¥æ“ä½œ AST</p>
<h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save babel-traverse</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>è¯¥æ¨¡å—ä»…æš´éœ²å‡ºä¸€ä¸ª traverse æ–¹æ³•ã€‚traverse æ–¹æ³•æ˜¯ä¸€ä¸ªéå†æ–¹æ³•ï¼Œ path å°è£…äº†æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”è¿˜æä¾›å®¹å™¨ container ï¼Œä½œç”¨åŸŸ scope è¿™æ ·çš„å­—æ®µã€‚æä¾›ä¸ªæ›´å¤šå…³äºèŠ‚ç‚¹çš„ç›¸å…³çš„ä¿¡æ¯ï¼Œè®©æˆ‘ä»¬æ›´å¥½çš„æ“ä½œèŠ‚ç‚¹ã€‚<br>ç¤ºä¾‹ï¼š  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">import</span> traverse <span class="keyword">from</span> <span class="string">"babel-traverse"</span>;</span><br><span class="line"></span><br><span class="line">traverse(ast, &#123;</span><br><span class="line">  enter(path) &#123;</span><br><span class="line">    <span class="keyword">if</span> (path.node.type === <span class="string">"Identifier"</span></span><br><span class="line">      &amp;&amp; path.node.name === <span class="string">'text'</span>) &#123;</span><br><span class="line">      path.node.name = <span class="string">'alteredText'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="ç”Ÿæˆå™¨-babel-generator"><a href="#ç”Ÿæˆå™¨-babel-generator" class="headerlink" title="ç”Ÿæˆå™¨ babel-generator"></a>ç”Ÿæˆå™¨ babel-generator</h2><p>å¯ä»¥æ ¹æ® AST ç”Ÿæˆä»£ç </p>
<h2 id="å®‰è£…-2"><a href="#å®‰è£…-2" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install --save babel-generator</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> generate <span class="keyword">from</span> <span class="string">"babel-generator"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> genCode = generate(ast, &#123;&#125;, code);</span><br></pre></td></tr></table></figure>

<h1 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h1><h2 id="ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–"><a href="#ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–"></a>ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–</h2><p>æœ€å¼€å§‹æˆ‘ä»¬æåˆ°ï¼Œéœ€è¦æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾ã€‚é‚£ä¹ˆæˆ‘ä»¬å…ˆä»ç¬¬ä¸€æ­¥å¼€å§‹ï¼Œå®ç°æ ¹æ®æŸä¸ªæ–‡ä»¶ï¼ˆè¾“å…¥ç»å¯¹è·¯å¾„ï¼‰æå–ä¾èµ–ã€‚å¤§è‡´å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>è¯»å–æ–‡ä»¶å†…å®¹</li>
<li>ç”Ÿæˆ AST</li>
<li>éå† AST æ¥ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—</li>
<li>ä¸ºè¯¥æ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li>ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨</li>
</ol>
<h3 id="è¯»å–æ–‡ä»¶å†…å®¹"><a href="#è¯»å–æ–‡ä»¶å†…å®¹" class="headerlink" title="è¯»å–æ–‡ä»¶å†…å®¹"></a>è¯»å–æ–‡ä»¶å†…å®¹</h3><p>æˆ‘ä»¬ç”¨ node.js çš„ <code>fs</code> æ¨¡å—å°±å¯ä»¥</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> content = fs.readFileSync(filename, <span class="string">'utf-8'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆ-AST"><a href="#ç”Ÿæˆ-AST" class="headerlink" title="ç”Ÿæˆ AST"></a>ç”Ÿæˆ AST</h3><p>ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ babylon</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ast = babylon.parse(content, &#123;</span><br><span class="line">  sourceType: <span class="string">'module'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="éå†-AST-æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—"><a href="#éå†-AST-æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—" class="headerlink" title="éå† AST æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—"></a>éå† AST æ¥è¯•ç€ç†è§£è¿™ä¸ªæ¨¡å—ä¾èµ–å“ªäº›æ¨¡å—</h3><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦æ“ä½œ ASTï¼Œæ‰€ä»¥ç”¨åˆ° babel-traverse</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> dependencies = [];</span><br><span class="line"><span class="comment">// è¦åšåˆ°è¿™ä¸€ç‚¹,æˆ‘ä»¬æ£€æŸ¥`ast`ä¸­çš„æ¯ä¸ª `import` å£°æ˜.</span></span><br><span class="line">traverse(ast, &#123;</span><br><span class="line"><span class="comment">// `Ecmascript`æ¨¡å—ç›¸å½“ç®€å•,å› ä¸ºå®ƒä»¬æ˜¯é™æ€çš„. è¿™æ„å‘³ç€ä½ ä¸èƒ½`import`ä¸€ä¸ªå˜é‡,</span></span><br><span class="line"><span class="comment">// æˆ–è€…æœ‰æ¡ä»¶åœ°`import`å¦ä¸€ä¸ªæ¨¡å—. </span></span><br><span class="line"><span class="comment">// æ¯æ¬¡æˆ‘ä»¬çœ‹åˆ°`import`å£°æ˜æ—¶,æˆ‘ä»¬éƒ½å¯ä»¥å°†å…¶æ•°å€¼è§†ä¸º`ä¾èµ–æ€§`.</span></span><br><span class="line">  ImportDeclaration: <span class="function">(<span class="params">&#123;node&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    dependencies.push(node.source.value);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦"><a href="#ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦" class="headerlink" title="ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦"></a>ä¸ºæ¨¡å—åˆ†é…å”¯ä¸€æ ‡è¯†ç¬¦</h3><p>æˆ‘ä»¬ç®€å•åœ°ç”¨ id è¡¨ç¤º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F; é€’å¢ç®€å•è®¡æ•°å™¨</span><br><span class="line">const id &#x3D; ID++;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨"><a href="#ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨" class="headerlink" title="ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨"></a>ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨</h3><p>ä½¿ç”¨ <a href="https://www.babeljs.cn/docs/">babel</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;transformFromAst&#125; = <span class="built_in">require</span>(<span class="string">'babel-core'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯¥`presets`é€‰é¡¹æ˜¯ä¸€ç»„è§„åˆ™,å‘Šè¯‰`babel`å¦‚ä½•ä¼ è¾“æˆ‘ä»¬çš„ä»£ç . </span></span><br><span class="line"><span class="comment">// æˆ‘ä»¬ç”¨`babel-preset-env``å°†æˆ‘ä»¬çš„ä»£ç è½¬æ¢ä¸ºæµè§ˆå™¨å¯ä»¥è¿è¡Œçš„ä¸œè¥¿. </span></span><br><span class="line"><span class="keyword">const</span> &#123;code&#125; = transformFromAst(ast, <span class="literal">null</span>, &#123;</span><br><span class="line">  presets: [<span class="string">'env'</span>],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆ code åˆ°åº•é•¿ä»€ä¹ˆæ ·å‘¢</p>
<blockquote>
<ol>
<li>é¦–å…ˆï¼Œbabel èƒ½å°† es6 ç­‰æ›´æ–°çš„ä»£ç è½¬æˆæµè§ˆå™¨èƒ½æ‰§è¡Œçš„ä½ç‰ˆæœ¬ä»£ç ï¼Œè¿™ä¸ªä¹‹å‰ä¸€ç›´åœ¨å¼ºè°ƒçš„</li>
<li>å…¶æ¬¡ï¼Œå¯¹äºæ¨¡å—çš„è½¬æ¢ã€‚Babel å¯¹ ES6 æ¨¡å—è½¬ç å°±æ˜¯è½¬æ¢æˆ CommonJS è§„èŒƒ  <blockquote>
<ul>
<li>Babel å¯¹äºæ¨¡å—è¾“å‡ºçš„è½¬æ¢ï¼Œå°±æ˜¯æŠŠæ‰€æœ‰è¾“å‡ºéƒ½èµ‹å€¼åˆ° exports å¯¹è±¡çš„å±æ€§ä¸Šï¼Œå¹¶åŠ ä¸Š ESModule: true çš„æ ‡è¯†ã€‚è¡¨ç¤ºè¿™ä¸ªæ¨¡å—æ˜¯ç”± ESModule è½¬æ¢æ¥çš„ CommonJS è¾“å‡º</li>
<li>è¾“å…¥å°±æ˜¯ require</li>
</ul>
</blockquote>
</li>
</ol>
</blockquote>
<p>ä¾‹å¦‚ï¼Œå¯¹äºä»¥ä¸‹æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// entry.js</span></span><br><span class="line"><span class="keyword">import</span> message <span class="keyword">from</span> <span class="string">'./message.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message);</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line"><span class="comment">// message.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;name&#125; <span class="keyword">from</span> <span class="string">'./name.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">`hello <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§ä¸Šé¢çš„è§„èŒƒï¼Œè½¬æ¢åçš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·å¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// entry.js</span></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="keyword">var</span> _message = <span class="built_in">require</span>(<span class="string">"./message.js"</span>);</span><br><span class="line"><span class="keyword">var</span> _message2 = _interopRequireDefault(_message);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_interopRequireDefault</span>(<span class="params">obj</span>) </span>&#123; </span><br><span class="line">  <span class="keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : &#123; <span class="attr">default</span>: obj &#125;; </span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(_message2.default);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// message.js</span></span><br><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ ä¸Š ESModule: true çš„æ ‡è¯†</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</span><br><span class="line">  value: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> _name = <span class="built_in">require</span>(<span class="string">"./name.js"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠæ‰€æœ‰è¾“å‡ºéƒ½èµ‹å€¼åˆ° exports å¯¹è±¡çš„å±æ€§ä¸Š</span></span><br><span class="line">exports.default = <span class="string">"hello "</span> + _name.name + <span class="string">"!"</span>;</span><br></pre></td></tr></table></figure>


<h3 id="è¿”å›æ¨¡å—ä¿¡æ¯"><a href="#è¿”å›æ¨¡å—ä¿¡æ¯" class="headerlink" title="è¿”å›æ¨¡å—ä¿¡æ¯"></a>è¿”å›æ¨¡å—ä¿¡æ¯</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  id,</span><br><span class="line">  filename,</span><br><span class="line">  dependencies,</span><br><span class="line">  code,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šï¼Œæˆ‘ä»¬å°±å¤„ç†å¥½äº†ä¸€ä¸ªæ¨¡å—ã€‚åŒ…å«ç€ä»¥ä¸‹ 4 é¡¹ä¿¡æ¯  </p>
<ul>
<li>æ¨¡å— id</li>
<li>æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</li>
<li>è¯¥æ¨¡å—çš„ä¾èµ–ã€‚ä¿å­˜ç€çš„æ˜¯ä¾èµ–ä»¬çš„ç›¸å¯¹è·¯å¾„</li>
<li>è¯¥æ¨¡å—å†…éƒ¨ä»£ç ï¼ˆæµè§ˆå™¨å¯è¿è¡Œï¼‰</li>
</ul>
<h2 id="ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾"><a href="#ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾"></a>ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆä¾èµ–å›¾</h2><p>é€šè¿‡ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»èƒ½ç”ŸæˆæŸä¸ªæ¨¡å—çš„ä¾èµ–äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é¡ºè—¤æ‘¸ç“œï¼Œä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œç”Ÿæˆå…¥å£æ–‡ä»¶çš„ä¾èµ–ï¼Œå†ç”Ÿæˆå…¥å£æ–‡ä»¶çš„ä¾èµ–çš„ä¾èµ–ï¼Œå†ç”Ÿæˆå…¥å£æ–‡ä»¶çš„ä¾èµ–çš„ä¾èµ–ä¾â€¦ï¼ˆç¦æ­¢å¥—å¨ƒï¼‰ï¼Œç›´åˆ°æ‰€æœ‰æ¨¡å—å¤„ç†å®Œæ¯•</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// entry ä¸ºå…¥å£æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createGraph</span>(<span class="params">entry</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// createAsset æ˜¯æˆ‘ä»¬åœ¨ã€ç¬¬ä¸€æ­¥ï¼Œæå–æŸæ–‡ä»¶çš„ä¾èµ–ã€‘ä¸­å®ç°çš„å‡½æ•°</span></span><br><span class="line">  <span class="comment">// mainAsset å°±æ˜¯å…¥å£æ¨¡å—çš„ä¿¡æ¯äº†</span></span><br><span class="line">  <span class="keyword">const</span> mainAsset = createAsset(entry);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼Œåˆšå¼€å§‹åªæœ‰å…¥å£æ¨¡å—</span></span><br><span class="line">  <span class="keyword">const</span> queue = [mainAsset];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> asset <span class="keyword">of</span> queue) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// mapping ç”¨æ¥å°†ã€ä¾èµ–çš„ç›¸å¯¹è·¯å¾„ã€‘æ˜ å°„åˆ°ã€è¯¥ä¾èµ–çš„æ¨¡å— idã€‘</span></span><br><span class="line">    asset.mapping = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ¨¡å—æ‰€åœ¨çš„ç›®å½•. </span></span><br><span class="line">    <span class="keyword">const</span> dirname = path.dirname(asset.filename);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ¯ä¸€ä¸ªä¾èµ–ã€‚</span></span><br><span class="line">    asset.dependencies.forEach(<span class="function"><span class="params">relativePath</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¾—åˆ°ä¾èµ–çš„ç»å¯¹è·¯å¾„</span></span><br><span class="line">      <span class="keyword">const</span> absolutePath = path.join(dirname, relativePath);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¾—åˆ° child çš„æ¨¡å—ä¿¡æ¯</span></span><br><span class="line">      <span class="keyword">const</span> child = createAsset(absolutePath);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å°†ã€ä¾èµ–çš„ç›¸å¯¹è·¯å¾„ã€‘æ˜ å°„åˆ°ã€è¯¥ä¾èµ–çš„æ¨¡å— idã€‘</span></span><br><span class="line">      <span class="comment">// å› ä¸ºå¦‚æœä¸åšæ˜ å°„ã€‚æœ€ç»ˆæ‰“åŒ…åˆ°ä¸€ä¸ªæ–‡ä»¶åï¼Œç¼–ç æ—¶çš„ç›¸å¯¹è·¯å¾„å°±ä¸ç®¡ç”¨äº†ã€‚æˆ‘ä»¬å°±æ²¡æ³•çŸ¥é“åƒ require('./child') è¿™ç§ä»£ç åˆ°åº•åº”è¯¥åŠ è½½å“ªä¸€ä¸ªæ¨¡å—</span></span><br><span class="line">      asset.mapping[relativePath] = child.id;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æŠŠè¿™ä¸ªå­æ¨¡å—ä¹Ÿæ”¾è¿›é˜Ÿåˆ—é‡Œé¢</span></span><br><span class="line">      queue.push(child);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ°è¿™ä¸€æ­¥,é˜Ÿåˆ— å°±æ˜¯ä¸€ä¸ªåŒ…å«ç›®æ ‡åº”ç”¨ä¸­ æ¯ä¸ªæ¨¡å— çš„æ•°ç»„</span></span><br><span class="line"><span class="comment">// å®é™…ä¸Šè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„ä¾èµ–å…³ç³»å›¾äº†</span></span><br><span class="line">  <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºä»¥ä¸‹æ–‡ä»¶</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ./example/entry.js</span></span><br><span class="line"><span class="keyword">import</span> message <span class="keyword">from</span> <span class="string">'./message.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(message);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ./example/message.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;name&#125; <span class="keyword">from</span> <span class="string">'./name.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="string">`hello <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ./example/name.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> name = <span class="string">'world'</span>;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¤„ç†åçš„ä¾èµ–å…³ç³»å›¾åº”è¯¥æ˜¯è¿™æ ·çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">    id: <span class="number">0</span>,</span><br><span class="line">    filename: <span class="string">'./example/entry.js'</span>,</span><br><span class="line">    dependencies: [<span class="string">'./message.js'</span>],</span><br><span class="line">    code: ,<span class="comment">// ç•¥</span></span><br><span class="line">    mapping: &#123;</span><br><span class="line">        <span class="string">'./message.js'</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    filename: <span class="string">'./example/message.js'</span>,</span><br><span class="line">    dependencies: [<span class="string">'./name.js'</span>],</span><br><span class="line">    code: ,<span class="comment">// ç•¥</span></span><br><span class="line">    mapping: &#123;</span><br><span class="line">        <span class="string">'./name.js'</span>: <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    filename: <span class="string">'./example/name.js'</span>,</span><br><span class="line">    dependencies: [],</span><br><span class="line">    code: ,<span class="comment">// ç•¥</span></span><br><span class="line">    mapping: &#123;&#125;</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç "><a href="#ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç " class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç "></a>ç¬¬ä¸‰æ­¥ï¼Œæ ¹æ®ä¾èµ–å›¾ç”Ÿæˆä»£ç </h3><p>ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¾èµ–å›¾</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">graph: Module[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Module &#123;</span><br><span class="line">  id: <span class="built_in">number</span> <span class="comment">// æ¨¡å—idï¼›åœ¨ã€æå–æŸæ–‡ä»¶çš„ä¾èµ–ã€‘è¿™ä¸€æ­¥ä¸­æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªé€’å¢çš„ id</span></span><br><span class="line">  filename: <span class="built_in">string</span> </span><br><span class="line">  dependencies: Module[]</span><br><span class="line">  code: <span class="built_in">string</span> <span class="comment">// è¯¥æ¨¡å—çš„ä»£ç ï¼ˆç»è¿‡è½¬æ¢çš„ï¼Œèƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼‰ </span></span><br><span class="line">  mapping: Record&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; <span class="comment">// å°†ä¾èµ–çš„ç›¸å¯¹è·¯å¾„è½¬æ¢æˆidã€‚æ˜¯æˆ‘ä»¬åœ¨ã€ç”Ÿæˆä¾èµ–å›¾ã€‘è¿™ä¸€æ­¥æ‰€åšçš„å·¥ä½œ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">æ—¢ç„¶å·²ç»åˆ°äº†è¿™ä¸€æ­¥äº†ï¼Œå°±è¯´æ˜æˆ‘ä»¬å¾—å¤„ç†ä¸€ä¸‹ `</span>code<span class="string">` äº†ã€‚åœ¨ã€ä½¿ä»£ç æ”¯æŒæ‰€æœ‰æµè§ˆå™¨ã€‘è¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œ`</span>code<span class="string">` æ˜¯ç¬¦åˆ CommonJS è§„èŒƒçš„ã€‚ä½†CommonJS ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªä¸œè¥¿ï¼Œæ˜¯æµè§ˆå™¨ä¸­æ²¡æœ‰çš„ï¼š  </span></span><br><span class="line"><span class="string">- require </span></span><br><span class="line"><span class="string">- module </span></span><br><span class="line"><span class="string">- exports  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»¬è‡ªå·±å®ç°è¿™3ä¸ªä¸œè¥¿ï¼</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">é¦–å…ˆæŠŠå’±ç›®å‰çš„æ¨¡å—ä¿¡æ¯æ•´åˆä¸€ä¸‹ï¼š</span></span><br><span class="line"><span class="string">- mapping æ˜¯è‚¯å®šè¦çš„ã€‚å› ä¸ºæˆ‘ä»¬æ¨¡å—çš„è¢«è½¬æ¢åä¼šé€šè¿‡ç›¸å¯¹è·¯å¾„æ¥è°ƒç”¨ require() ï¼Œè€Œæˆ‘ä»¬éœ€è¦çŸ¥é“å¯¹åº”å»åŠ è½½å“ªä¸ªæ¨¡å—  </span></span><br><span class="line"><span class="string">- code éœ€è¦ç¨å¾®æ”¹ä¸€ä¸‹ã€‚æ¯ä¸ªæ¨¡å—çš„ä½œç”¨åŸŸåº”è¯¥æ˜¯ç‹¬ç«‹çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ”¹æˆè¿™æ ·ï¼š</span></span><br><span class="line"><span class="string">  `</span><span class="string">``</span>javascript</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="built_in">module</span>, exports</span>) </span>&#123; </span><br><span class="line">    &#123;code&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæŠŠæ‰€æœ‰è¿™æ ·çš„æ¨¡å—æ”¾åœ¨ modules ä¸­ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  &#123;0: [</span></span><br><span class="line"><span class="comment">    function (require, module, exports) &#123; </span></span><br><span class="line"><span class="comment">      &#123;code&#125;</span></span><br><span class="line"><span class="comment">    &#125;,</span></span><br><span class="line"><span class="comment">    mapping: &#123;</span></span><br><span class="line"><span class="comment">      './message.js': 1</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  ]&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">modules: Record&lt;<span class="built_in">number</span>, [<span class="function">(<span class="params"><span class="built_in">require</span>, <span class="built_in">module</span>, exports</span>) =&gt;</span> <span class="built_in">any</span>, Record&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt;]&gt;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸»ç¨‹åºï¼Œæˆ‘ä»¬ä¸»ç¨‹åºè¦åšçš„å·¥ä½œæœ‰</p>
<ol>
<li>å®ç° <code>require</code>, <code>module</code>, <code>exports</code></li>
<li>é»˜è®¤è°ƒç”¨å…¥å£æ–‡ä»¶</li>
<li>è‡ªæ‰§è¡Œ</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">id</span>) </span>&#123; </span><br><span class="line">    <span class="comment">// ä» modules æ‹¿åˆ° ã€æ‰§è¡Œå‡½æ•°ã€‘å’Œã€mappingã€‘</span></span><br><span class="line">    <span class="keyword">const</span> [fn, mapping] = modules[id];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå·±å®ç°çš„ requireï¼Œå¯ä»¥æ ¹æ®ç›¸å¯¹è·¯å¾„åŠ è½½ä¾èµ–</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">localRequire</span>(<span class="params">name</span>) </span>&#123; </span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(mapping[name]); </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// // è‡ªå·±å®ç°çš„ module å’Œ exports</span></span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">module</span> = &#123; <span class="attr">exports</span> : &#123;&#125; &#125;;</span><br><span class="line"></span><br><span class="line">    fn(localRequire, <span class="built_in">module</span>, <span class="built_in">module</span>.exports); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è°ƒç”¨å…¥å£æ–‡ä»¶</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="number">0</span>);</span><br><span class="line">  </span><br><span class="line">&#125;)(modules)</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>webpack</tag>
        <tag>æ‰“åŒ…å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>å¦‚ä½•å®ç°ä¸€ä¸ªæ·±æ‹·è´</title>
    <url>/2020/05/01/deepcopy/</url>
    <content><![CDATA[<p>è¿™éƒ¨åˆ†æˆ‘æ˜¯çœ‹äº† <a href="https://github.com/lodash/lodash/blob/4.17.15/lodash.js#L11087">lodash</a> çš„ç›¸å…³æºç ï¼Œå®ƒçœŸçš„å®ç°å¾—éå¸¸å®Œæ•´ï¼<br>æ€»ç»“æˆä¸€å¥è¯ï¼Œå°±æ˜¯éœ€è¦è€ƒè™‘å¾ˆå¤šæ•°æ®ç±»å‹ï¼Œç„¶åé’ˆå¯¹è¿™äº›æ•°æ®ç±»å‹æ‹·è´å°±è¡Œäº†ğŸ˜</p>
<a id="more"></a>


<p>å¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´ï¼Œæˆ‘ä»¬åŸºæœ¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ€è·¯èµ°ï¼š  </p>
<ol>
<li>åˆå§‹åŒ–ã€‚å³è°ƒç”¨ç›¸åº”çš„æ„é€ å‡½æ•°</li>
<li>é€’å½’åœ°èµ‹å€¼</li>
<li>æœ‰å¾ªç¯å¼•ç”¨çš„è¯éœ€è¦å¤„ç†ä¸€ä¸‹</li>
</ol>
<h1 id="æ‹·è´åŸºæœ¬ç±»å‹"><a href="#æ‹·è´åŸºæœ¬ç±»å‹" class="headerlink" title="æ‹·è´åŸºæœ¬ç±»å‹"></a>æ‹·è´åŸºæœ¬ç±»å‹</h1><p>åŸºæœ¬ç±»å‹ç›´æ¥èµ‹å€¼å°±å¯ä»¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> type = <span class="keyword">typeof</span> value</span><br><span class="line">    <span class="keyword">return</span> value != <span class="literal">null</span> &amp;&amp; (type === <span class="string">'object'</span> || type === <span class="string">'function'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>æ¥ä¸‹æ¥æ˜¯æ€ä¹ˆæ‹·è´å¼•ç”¨ç±»å‹ã€‚æˆ‘ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ¥ä»‹ç»ï¼š</p>
<ol>
<li>æ•°ç»„</li>
<li>å‡½æ•°</li>
<li>å¯¹è±¡</li>
<li>ç‰¹æ®Šç±»å‹ã€‚Booleanã€Dateã€Mapã€Number ç­‰ç­‰</li>
</ol>
<p>å¦å¤–ï¼Œlodash è¿˜å®ç°äº† Bufferï¼ˆnode.jsï¼‰ç­‰æ‹·è´ï¼Œä½†æˆ‘å®é™…ç”¨å¾—ä¸å¤šï¼Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å»çœ‹çœ‹æºç ã€‚</p>
<h1 id="æ‹·è´æ•°ç»„"><a href="#æ‹·è´æ•°ç»„" class="headerlink" title="æ‹·è´æ•°ç»„"></a>æ‹·è´æ•°ç»„</h1><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>å…ˆåˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸ºåŸæ•°ç»„é•¿åº¦çš„æ•°ç»„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¾…ç»­</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hasOwnProperty = <span class="built_in">Object</span>.prototype.hasOwnProperty</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCloneArray</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; length &#125; = array</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">new</span> array.constructor(length)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸º RegExp.prototype.exec() ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„æˆ– nullï¼Œè¿™ä¸ªæ•°ç»„é‡Œæœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼šinputã€index</span></span><br><span class="line">    <span class="comment">// ç±»ä¼¼ ["foo", index: 6, input: "table football, foosball", groups: undefined]</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> (length &amp;&amp; <span class="keyword">typeof</span> array[<span class="number">0</span>] === <span class="string">'string'</span> &amp;&amp; hasOwnProperty.call(array, <span class="string">'index'</span>)) &#123;</span><br><span class="line">        result.index = array.index</span><br><span class="line">        result.input = array.input</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="èµ‹å€¼"><a href="#èµ‹å€¼" class="headerlink" title="èµ‹å€¼"></a>èµ‹å€¼</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> value) &#123;</span><br><span class="line">        result[k] = deepClone(value[k])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ‹·è´å‡½æ•°"><a href="#æ‹·è´å‡½æ•°" class="headerlink" title="æ‹·è´å‡½æ•°"></a>æ‹·è´å‡½æ•°</h1><p>å‡½æ•°çš„æ‹·è´çš„è¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¿”å›ä¹‹å‰çš„å¼•ç”¨ã€‚  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„</span></span><br><span class="line">    <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">        result = initCloneArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> isFunc = <span class="keyword">typeof</span> value === <span class="string">'function'</span></span><br><span class="line">        <span class="comment">// å‡½æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (isFunc) &#123;</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èµ‹å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> value) &#123;</span><br><span class="line">        result[k] = deepClone(value[k])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ‹·è´å¯¹è±¡"><a href="#æ‹·è´å¯¹è±¡" class="headerlink" title="æ‹·è´å¯¹è±¡"></a>æ‹·è´å¯¹è±¡</h1><p>åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åèµ‹å€¼ã€‚<br>è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªæ‹·è´åçš„å¯¹è±¡å’ŒåŸå¯¹è±¡çš„åŸå‹é“¾æ˜¯ä¸€æ ·çš„</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepClone</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (!isObject(value)) &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> isArr = <span class="built_in">Array</span>.isArray(value)</span><br><span class="line">  <span class="keyword">const</span> tag = getTag(value)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ•°ç»„</span></span><br><span class="line">  <span class="keyword">if</span> (isArr) &#123;</span><br><span class="line">    result = initCloneArray(value)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> isFunc = <span class="keyword">typeof</span> value === <span class="string">'function'</span></span><br><span class="line">    <span class="comment">// å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (isFunc) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹è±¡æˆ– arguments</span></span><br><span class="line">    <span class="keyword">if</span> (tag == <span class="string">'[object Object]'</span> || tag == <span class="string">'[object Arguments]'</span>) &#123;</span><br><span class="line">      result = initCloneObject(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹è±¡æˆ–æ•°ç»„èµ‹å€¼</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> value) &#123;</span><br><span class="line">    result[k] = deepClone(value[k])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// èƒ½æ›´ç»†è‡´åœ°åˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getTag</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> value === <span class="literal">undefined</span> ? <span class="string">'[object Undefined]'</span> : <span class="string">'[object Null]'</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> toString.call(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objectProto = <span class="built_in">Object</span>.prototype</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPrototype</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> Ctor = value &amp;&amp; value.constructor</span><br><span class="line">    <span class="keyword">const</span> proto = (<span class="keyword">typeof</span> Ctor === <span class="string">'function'</span> &amp;&amp; Ctor.prototype) || objectProto</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">return</span> value === proto</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initCloneObject</span>(<span class="params">object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> object.constructor === <span class="string">'function'</span> &amp;&amp; !isPrototype(object))</span><br><span class="line">      ? <span class="built_in">Object</span>.create(<span class="built_in">Object</span>.getPrototypeOf(object))</span><br><span class="line">      : &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ‹·è´ç‰¹æ®Šç±»å‹"><a href="#æ‹·è´ç‰¹æ®Šç±»å‹" class="headerlink" title="æ‹·è´ç‰¹æ®Šç±»å‹"></a>æ‹·è´ç‰¹æ®Šç±»å‹</h1><p>åŒ…æ‹¬ <code>Boolean</code>, <code>Date</code>, <code>Error</code>, <code>Map</code>, <code>Number</code>, <code>RegExp</code>, <code>Set</code>,  <code>String</code></p>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
</search>
